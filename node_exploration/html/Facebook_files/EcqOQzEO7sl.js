/*!CK:843105550!*//*1410547001,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["gh9zw"]); }

__d("SpotlightViewerLoggingEvents",[],function(a,b,c,d,e,f){e.exports={LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"};},null);
__d("VideoPlayerLoggerEvents",[],function(a,b,c,d,e,f){e.exports={AUTOPLAY_PREFERENCE_CHANGED:"autoplay_preference_changed",END_STALL_TIME:"end_stall_time",AUTOPLAY_PREFERENCE_STATUS:"autoplay_preference_status",NOT_AUTOPLAYING:"not_autoplaying",VIDEO_ORIENTATION_CHANGED:"video_orientation_changed",ASSETS_LOADED:"assets_loaded",BUFFERED:"buffered",CANCELLED_REQUESTED_PLAYING:"cancelled_requested_playing",CAROUSEL_CHANGE:"carousel_change",DISPLAYED:"displayed",ENTERED_HD:"entered_hd",ENTERED_FALLBACK:"entered_fallback",ENTERED_FS:"entered_fs",EXITED_HD:"exited_hd",EXITED_FS:"exited_fs",ERROR:"error",FINISHED_PLAYING:"finished_playing",IMPRESSION:"impression",INVALID_URL:"invalid_url",MUTED:"muted",PAUSED:"paused",PLAY_REQUESTED:"play_requested",PLAYER_LOADED:"player_loaded",PROGRESS:"progress",READY_TO_PLAY:"ready_to_play",REPLAYED:"replayed",REQUESTED:"requested",REQUESTED_PLAYING:"requested_playing",SCRUBBED:"scrubbed",STARTED_PLAYING:"started_playing",STARTED_RECEIVING_BYTES:"started_receiving_bytes",STATS:"stats",STOPPED_PLAYING:"stopped_playing",UNMUTED:"unmuted",UNPAUSED:"unpaused",VOLUME_CHANGED:"volume_changed",VOLUME_DECREASE:"volume_decrease",VOLUME_INCREASE:"volume_increase",ENTER_LARGE_FORMAT:"enter_large_format",COMPLETION:"completion",VIEW:"view"};},null);
__d("VideoPlayerLoggerSources",[],function(a,b,c,d,e,f){e.exports={ADS:"ads",BROADCAST_REQUEST_ATTACHMENT:"broadcast_request_attachment",EMBEDDED:"embedded",HTML5:"html5",INLINE:"inline",INSIGHTS:"insights",LOOKBACK:"lookback",MISC:"misc",MOBILE:"mobile",PAGES_FINCH_MAIN_VIDEO:"pages_finch_main_video",PAGES_FINCH_THUMBNAIL_VIDEO:"pages_finch_thumbnail_video",PAGES_FINCH_TRAILER:"pages_finch_trailer",PAGES_VIDEO_SET:"pages_video_set",PERMALINK:"permalink",REPORT_FLOW:"report_flow",SNOWLIFT:"snowlift",TRAILER_LANDING_PAGE:"trailer_previews_landing_page",TRAILER_OG_ATTACHMENT:"trailer_og_attachment",TRAILER_TIMELINE_COLLECTIONS:"trailer_timeline_collections",TRAILER_TIMELINE_UNIT:"trailer_timeline_unit"};},null);
__d("VideoPlayerReason",[],function(a,b,c,d,e,f){e.exports={AUTOPLAY:"autoplay_initiated",USER:"user_initiated",PAGE_VISIBILITY:"page_visibility_initiated"};},null);
__d("VideoPlayerVersions",[],function(a,b,c,d,e,f){e.exports={CASABLANCA:"casablanca",HTML5:"html5",SILVERCITY:"silvercity"};},null);
__d("ImageUtils",["UserAgent_DEPRECATED"],function(a,b,c,d,e,f,g){var h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.webkit()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;},null);
__d("PhotoEverstoreLogger",["Event","AsyncRequest","copyProperties","ImageUtils"],function(a,b,c,d,e,f,g,h,i,j){var k={BATCH_WINDOW_MS:500,storedLog:[]};function l(){}i(l,{_log:function(n){k.storedLog.push(n);if(k.storedLog.length==1)setTimeout(m,k.BATCH_WINDOW_MS);},logImmediately:function(n){l._log(n);},registerForLogging:function(n){var o=document.getElementById(n);if(o!=null)if(j.hasLoaded(o)){l._log(o.src);}else g.listen(o,'load',function(event){l._log(o.src);});}});function m(){var n=k.storedLog;k.storedLog=[];var o=JSON.stringify(n);new h().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:o}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}e.exports=l;},null);
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_PERMALINK_STRING:'permalink',VIEWER_SNOWLIFT_STRING:'snowlift',VIEWER_VAULTBOX_STRING:'vaultbox',BULK_EDITOR:3,BULK_EDITOR_REACT:15,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180};e.exports=g;},null);
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector"],function(a,b,c,d,e,f,g,h,i){function j(k){"use strict";this._hiResDimensions=k.hiResDimensions&&i.deserialize(k.hiResDimensions);this._normalDimensions=k.normalDimensions&&i.deserialize(k.normalDimensions);this._info=k.info;this._video=k.video;this._shouldLog=k.everstoreLogThis;this._hiResSrc=k.hiResSrc;this._normalSrc=k.normalSrc;this._thumbSrc=k.thumbSrc;this._isInverted=false;this._data=k;}j.prototype.getURIString=function(){"use strict";return h(this._info.permalink).getUnqualifiedURI().toString();};j.prototype.hasHiResDimensions=function(){"use strict";return !!this._hiResDimensions;};j.prototype.getHiResDimensions=function(){"use strict";return this._hiResDimensions;};j.prototype.getNormalDimensions=function(){"use strict";return this._normalDimensions;};j.prototype.getHiResSrc=function(){"use strict";return this._hiResSrc;};j.prototype.getNormalSrc=function(){"use strict";return this._normalSrc;};j.prototype.getThumbSrc=function(){"use strict";return this._thumbSrc;};j.prototype.getInfo=function(){"use strict";return this._info;};j.prototype.getPermalink=function(){"use strict";return this._info.permalink;};j.prototype.getHighestResSrc=function(){"use strict";return this._hiResSrc||this._normalSrc;};j.prototype.preload=function(k){"use strict";var l;if(this.getHighestResSrc())if(k&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();l=this._resource.src;if(this._shouldLog)g.logImmediately(this._resource.src);}else if(!k&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;l=this._small.src;if(this._shouldLog)g.logImmediately(this._small.src);}return l;};j.prototype.setNormalDimensions=function(k,l){"use strict";this._normalDimensions=new i(k,l);};j.prototype.setHiResDimensions=function(k,l){"use strict";this._hiResDimensions=new i(k,l);};j.prototype.invertDimensions=function(){"use strict";if(this.hasHiResDimensions())this._hiResDimensions=new i(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new i(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;};j.prototype.copy=function(){"use strict";return new j(this._data);};e.exports=j;},null);
__d("PhotoStreamCache",["DOM","HTML","PhotoEverstoreLogger","PhotosConst","PhotoViewerImage","Rect","UIPagelet","URI","Vector","copyProperties","createArrayFrom","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){function s(){"use strict";}s.prototype.init=function(t,u,v,w,x){"use strict";this.version=t;this.pageletName=u;this.pageletRootID=v;this.tagSuggestionMode=x;this.bufferSize=s.BUFFER_SIZE;this.fullBucketSize=s.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=w;this.viewAsUser=null;this.reset();};s.prototype.setViewAs=function(t){"use strict";this.viewAsUser=t;};s.prototype.isInViewAsMode=function(){"use strict";return !!this.viewAsUser;};s.prototype.getViewAsUserId=function(){"use strict";return this.viewAsUser;};s.prototype.getUsesOpaqueCursor=function(){"use strict";return this.usesOpaqueCursor;};s.prototype.isNonCircularPhotoSet=function(){"use strict";return this.usesNonCircularPhotoSet;};s.prototype.setReachedLeftEnd=function(){"use strict";this.reachedLeftEnd=true;};s.prototype.setReachedRightEnd=function(){"use strict";this.reachedRightEnd=true;};s.prototype.hasReachedLeftEnd=function(){"use strict";return this.reachedLeftEnd;};s.prototype.hasReachedRightEnd=function(){"use strict";return this.reachedRightEnd;};s.prototype.nonCircularPhotoSetCanPage=function(t){"use strict";if(!this.isNonCircularPhotoSet())return true;if(t<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(t>0)return (this.getLength()-1!=this.getCursorPos())||!this.hasReachedRightEnd();return true;};s.prototype.setUseAjaxPipe=function(t){"use strict";this.useAjaxPipe=t;};s.prototype.reset=function(){"use strict";this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;};s.prototype.waitForInitData=function(){"use strict";this.fbidList.push(s.INIT_PLACEHOLDER);};s.prototype.destroy=function(){"use strict";this.reset();this.isActive=false;};s.prototype.isLoaded=function(){"use strict";return this.loaded;};s.prototype.canPage=function(){"use strict";if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;};s.prototype.errorInCurrent=function(){"use strict";if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());};s.prototype.getLength=function(){"use strict";return this.fbidList.length;};s.prototype.getPhotoSet=function(){"use strict";return this.photoSetQuery.set;};s.prototype.getPhotoSetQuery=function(){"use strict";return this.photoSetQuery;};s.prototype.getCurrentImageData=function(){"use strict";return this.getImageData(this.getCursor());};s.prototype.addViewAsToURI=function(t){"use strict";var u=n(t);if(this.isInViewAsMode())u.addQueryData({viewas:this.getViewAsUserId()});return u;};s.prototype.getOpaqueCursor=function(t){"use strict";if(this.getImageData(t)){if(this.version===j.VIEWER_VAULTBOX)return this.getImageData(t).getInfo().opaquecursor;return this.getImageData(t).info.opaquecursor;}if(t==this.firstCursor)return this.firstOpaqueCursor;return null;};s.prototype.getImageData=function(t){"use strict";var u=this.getCacheContent(t,s.IMAGE_DATA);if(u)u.info.permalink=this.addViewAsToURI(u.info.permalink);return u;};s.prototype.getCurrentHtml=function(){"use strict";return this.getCacheContent(this.getCursor(),s.HTML);};s.prototype.getCurrentExtraData=function(){"use strict";return this.getCacheContent(this.getCursor(),s.EXTRA);};s.prototype.getCacheContent=function(t,u){"use strict";if(!t||t===s.ERROR_ID||t===s.INIT_PLACEHOLDER)return null;return this.cache[u][t];};s.prototype.getCursorPos=function(){"use strict";return this.position;};s.prototype.getCursor=function(){"use strict";if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;};s.prototype.getCursorAt=function(t){"use strict";return this.fbidList[t];};s.prototype.getCursorForURI=function(t){"use strict";return this.permalinkMap[t];};s.prototype.calculatePositionForMovement=function(t){"use strict";var u=this.position+t;if(this.allLoaded){var v=this.getLength();u=(v+u%v)%v;}return u;};s.prototype.isValidMovement=function(t){"use strict";if(!this.isLoaded()||!this.canPage())return false;var u=this.calculatePositionForMovement(t);return this.getCursor()>0||(u>=0&&u<this.getLength());};s.prototype.moveCursor=function(t){"use strict";if(!this.isValidMovement(t))return;this.position=this.calculatePositionForMovement(t);if(t!==0)this.loadMoreIfNeccessary(t>0);};s.prototype.checkErrorAt=function(t){"use strict";if(!this.isLoaded())return false;if(t===s.ERROR_ID)return true;return false;};s.prototype.getRelativeMovement=function(t){"use strict";for(var u=0;u<this.getLength();u++)if(this.fbidList[u]==t)return u-this.position;return null;};s.prototype.preloadImages=function(t){"use strict";var u,v,w=this.getLength(),x=this.cache.image,y=s.BUFFER_SIZE;if(w>y*2){u=(this.position+w-y%w)%w;v=(this.position+y)%w;}else{u=0;v=w-1;}while(u!=v){var z,aa=this.fbidList[u],ba=t&&t(x[aa]);if(this.version===j.VIEWER_VAULTBOX){z=x[aa]&&x[aa].preload(ba);}else if(x[aa]&&x[aa].url)if(ba&&!x[aa].resource){x[aa].resource=new Image();x[aa].resource.src=x[aa].url;z=x[aa].url;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].resource.src);}else if(!ba&&!x[aa].small){x[aa].small=new Image();x[aa].small.src=x[aa].smallurl||x[aa].url;z=x[aa].small.src;if(x[aa].everstoreLogThis===true)i.logImmediately(x[aa].small.src);}if(this.logger&&z)this.logger.log(z);u=(u+1)%w;}};s.prototype.loadMoreIfNeccessary=function(t){"use strict";if(this.allLoaded||(t&&this.rightLock)||(!t&&this.leftLock))return;var u=t?1:-1,v=this.position+this.bufferSize*u;if(v<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(v>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}};s.prototype.getEndCursor=function(t){"use strict";return t?this.fbidList[this.getLength()-1]:this.fbidList[0];};s.prototype.calculateRelativeIndex=function(t,u,v){"use strict";if(!this.totalCount)return null;var w=this.fbidList.indexOf(u),x=this.fbidList.indexOf(v);if(w===-1||x===-1)return null;var y=x-w;return (t+y+this.totalCount)%this.totalCount;};s.prototype.calculateDistance=function(t,u){"use strict";var v=this.fbidList.indexOf(t),w=this.fbidList.indexOf(u);if(v===-1||w===-1)return null;return (w-v+this.getLength())%this.getLength();};s.prototype.fetch=function(t,u){"use strict";var v=this.getEndCursor(u),w=p({cursor:v,version:this.version,end:this.getEndCursor(!u),fetchSize:u?t:-1*t,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(v),tagSuggestionMode:this.tagSuggestionMode},this.photoSetQuery);if(this.isInViewAsMode())w.viewas=this.getViewAsUserId();if(this.totalCount&&this.firstCursorIndex!==null){w.total=this.totalCount;w.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,v);}var x=r(this.pageletRootID);if(!x){x=g.create('div',{id:this.pageletRootID});g.appendContent(document.body,x);}m.loadFromEndpoint(this.pageletName,x,w,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);};s.prototype.storeToCache=function(t){"use strict";var u={};if(!this.isActive)return u;if('error' in t){this.processErrorResult(t.error);u.error=true;return u;}if('init' in t){this.processInitResult(t.init);u.init={logids:t.init.logids,fbid:t.init.fbid,loggedin:t.init.loggedin,fromad:t.init.fromad};}if('image' in t){this.processImageResult(t.image);u.image=true;}if('data' in t){this.processDataResult(t.data);u.data=true;}return u;};s.prototype.processInitResult=function(t){"use strict";if(this.loaded)return;this.usesOpaqueCursor=t.usesopaquecursor;this.usesNonCircularPhotoSet=t.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=t.query;if(t.bufferSize)this.bufferSize=t.bufferSize;if(t.fullBucketSize)this.fullBucketSize=t.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(t.fbid);this.rightLock=true;}else{var u=this.fbidList.indexOf(s.INIT_PLACEHOLDER);if(u!=-1)this.fbidList[u]=t.fbid;}this.firstCursor=t.fbid;this.firstOpaqueCursor=t.opaquecursor;if('initIndex' in t&&'totalCount' in t){this.firstCursorIndex=t.initIndex;this.totalCount=t.totalCount;}if(this.version==j.VIEWER_PERMALINK)this.fetch(s.INIT_BUCKET_SIZE,true);};s.prototype.processImageResult=function(t){"use strict";for(var u in t){if(u===this.firstCursor&&t[u].everstoreLogThis)i.logImmediately(t[u].url);if(this.version===j.VIEWER_VAULTBOX){var v=t[u];this.cache.image[u]=new k(v);this.permalinkMap[this.cache.image[u].getURIString()]=u;}else{this.cache.image[u]=t[u];if(t[u].dimensions)this.cache.image[u].dimensions=o.deserialize(t[u].dimensions);if(t[u].originalDimensions)this.cache.image[u].originalDimensions=o.deserialize(t[u].originalDimensions);if(t[u].smalldims)this.cache.image[u].smalldims=o.deserialize(t[u].smalldims);this.permalinkMap[n(t[u].info.permalink).getUnqualifiedURI().toString()]=u;}}};s.prototype.attachToFbidsList=function(t,u,v){"use strict";if(this.allLoaded)return;if(u===-1){for(var w=t.length-1;w>=0;w--){this.fbidList.unshift(t[w]);this.position++;}this.leftLock=false;}else{for(var x=0;x<t.length;x++)this.fbidList.push(t[x]);this.rightLock=false;}if(v)this.setAllLoaded();};s.prototype.setAllLoaded=function(){"use strict";this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);};s.prototype.processDataResult=function(t){"use strict";for(var u in t){if(!this.cache.html[u])this.cache.html[u]={};for(var v in t[u].html){var w=t[u].html[v];if(typeof w==='string')w=h(w).getRootNode();this.cache.html[u][v]=q(w.childNodes);}if(!('extra' in t[u])){this.cache.extra[u]=null;continue;}this.cache.extra[u]={tagRects:{}};if(!Array.isArray(t[u].extra.tagRects))for(var x in t[u].extra.tagRects)if(t[u].extra.tagRects[x])this.cache.extra[u].tagRects[x]=l.deserialize(t[u].extra.tagRects[x]);Object.keys(t[u].extra).forEach(function(y){if(y=='tagRects')return;this.cache.extra[u][y]=t[u].extra[y];}.bind(this));}};s.prototype.processErrorResult=function(t){"use strict";if(!this.isLoaded()){this.initError=true;return;}var u=t.side,v=[s.ERROR_ID];this.attachToFbidsList(v,u);};s.prototype.setTotalCount=function(t){"use strict";this.totalCount=t;};s.prototype.setFirstCursorIndex=function(t){"use strict";this.firstCursorIndex=t;};p(s,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});e.exports=s;},null);
__d("XPhotosetSearchPivotControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b("XControllerURIBuilder").create("\/search-pivot\/photoset\/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}});},null);
__d("PhotosetSearchPivotData",["AsyncRequest","Deferred","PhotoStreamCache","XPhotosetSearchPivotControllerURIBuilder"],function(a,b,c,d,e,f,g,h,i,j){var k=/^(perm:)?tag:(\d+)/,l={},m={fetch:function(n,o){if(!(n in l)){var p=l[n]=new h(),q=(new j()).setInt('fbid',n);if(o){var r={};o.fbidList.forEach(function(t){var u=o.getCacheContent(t,i.EXTRA);if(u)Object.keys(u.tagRects).forEach(function(v){if(k.test(v)){var w=RegExp.$2;if(w in r){r[w]++;}else r[w]=1;}});});q.setIntToIntMap('tags',r);}(new g()).setURI(q.getURI()).setHandler(function(t){p.succeed(t.getPayload());}).setErrorHandler(function(t){return p.fail(t);}).setAllowCrossPageTransition(true).send();}var s=new h();l[n].addCallback(function(t){return s.succeed(t);});l[n].addErrback(function(t){delete l[n];s.fail(t);});return s;}};e.exports=m;},null);
__d("ManagedError",[],function(a,b,c,d,e,f){function g(h,i){Error.prototype.constructor.call(this,h);this.message=h;this.innerError=i;}g.prototype=new Error();g.prototype.constructor=g;e.exports=g;},null);
__d("VideoPlayerLoggerErrors",[],function(a,b,c,d,e,f){e.exports={ENTERED_FALLBACK:'entered_fallback',ERROR_CALLING_FLASH:'error_calling_flash'};},null);
__d("VideoPlayerLoggerErrorStates",[],function(a,b,c,d,e,f){e.exports={PLAYBACK_FAILURE:'playback_failure',PLAYER_FAILURE:'player_failure'};},null);
__d("VideoPlayerLoggerFallbackReasons",[],function(a,b,c,d,e,f){e.exports={TIMEOUT:'timeout',FLASH_ERROR:'flash_error',FLASH_UNAVAILABLE:'flash_unavailable'};},null);
__d("VideoPlayerLoggerPlayerStates",[],function(a,b,c,d,e,f){e.exports={STARTED:'started',UNPAUSED:'unpaused'};},null);
__d("VideoPlayerLogger",["Banzai","ErrorUtils","TimeSpentImmediateActiveSecondsLogger","VideoPlayerLoggerEvents","VideoPlayerLoggerErrors","VideoPlayerLoggerErrorStates","VideoPlayerLoggerFallbackReasons","VideoPlayerLoggerSources","VideoPlayerLoggerPlayerStates","copyProperties","ex"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r='video_player';function s(t,u){"use strict";this.$VideoPlayerLogger0=t;this.$VideoPlayerLogger1=null;this.$VideoPlayerLogger2={};this.$VideoPlayerLogger3=u;this.$VideoPlayerLogger4();}s.prototype.logEvent=function(event,t){"use strict";p(t,this.$VideoPlayerLogger3);if(this.$VideoPlayerLogger2.hasOwnProperty(event)){t.initial_event=false;}else t.initial_event=this.$VideoPlayerLogger2[event]=true;if(!t.hasOwnProperty('time'))t.time=Math.round(Date.now()/1000);t.time_ms=Date.now();if(this.$VideoPlayerLogger1)p(t,this.$VideoPlayerLogger1);switch(event){case j.REQUESTED_PLAYING:this.$VideoPlayerLogger4();this.$VideoPlayerLogger5();this.$VideoPlayerLogger6=true;if(this.$VideoPlayerLogger2[j.STARTED_PLAYING]){t.state=o.UNPAUSED;}else t.state=o.STARTED;break;case j.STARTED_PLAYING:case j.UNPAUSED:case j.FINISHED_PLAYING:case j.CANCELLED_REQUESTED_PLAYING:case j.ERROR:case j.PAUSED:if(event===j.ERROR&&t.state!==l.PLAYBACK_FAILURE)break;if(this.$VideoPlayerLogger6)this.$VideoPlayerLogger7();this.$VideoPlayerLogger8(t);this.$VideoPlayerLogger4();break;}var u={logData:t,event:event,scriptPath:this.$VideoPlayerLogger9,source:this.$VideoPlayerLogger0};if(!event)h.reportError(new Error(q('VideoPlayerLogger: Missing event name')),false);if(t.ad_client_token){g.post(r,u,g.VITAL);}else g.post(r,u);if(event===j.FINISHED_PLAYING||event===j.PAUSED){var v=t.time_ms||Date.now(),w=t.video_time_position-t.video_last_start_time_position;if(w>=0)i.maybeReportActiveInterval('video',v-Math.floor(w*1000),v);}};s.prototype.setScriptPath=function(t){"use strict";this.$VideoPlayerLogger9=t;};s.prototype.setFTData=function(t){"use strict";this.$VideoPlayerLogger1=t;};s.prototype.startBuffering=function(){"use strict";this.$VideoPlayerLogger5();};s.prototype.endBuffering=function(){"use strict";if(this.$VideoPlayerLoggera>0)this.$VideoPlayerLogger7();};s.prototype.$VideoPlayerLogger5=function(){"use strict";this.$VideoPlayerLoggera=Date.now();};s.prototype.$VideoPlayerLogger7=function(){"use strict";this.$VideoPlayerLoggerb=this.$VideoPlayerLoggerb+(Date.now()-this.$VideoPlayerLoggera);this.$VideoPlayerLoggerc++;};s.prototype.$VideoPlayerLogger8=function(t){"use strict";if(t.player_version==='silvercity'){t.stall_time=Math.max(0,this.$VideoPlayerLoggerb);t.stall_count=this.$VideoPlayerLoggerc;}};s.prototype.$VideoPlayerLogger4=function(){"use strict";this.$VideoPlayerLoggerb=0;this.$VideoPlayerLoggera=0;this.$VideoPlayerLoggerc=0;this.$VideoPlayerLogger6=false;};p(s,{Sources:n,Errors:k,FallbackReasons:m,ErrorStates:l,PlayerStates:o});e.exports=s;},null);
__d("PhotoLogger",["Event","BanzaiScuba","SpotlightViewerLoggingEvents","SubscriptionsHandler"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this.$PhotoLogger0=l;this.$PhotoLogger1={};}k.prototype.log=function(l){"use strict";if(!this.$PhotoLogger1[l]){this.$PhotoLogger2(l);this.$PhotoLogger1[l]=true;}};k.prototype.$PhotoLogger2=function(l){"use strict";this.$PhotoLogger3(i.LOADING,{uri:l});var m=new j(),n=new Image();m.addSubscriptions(g.listen(n,'load',function(){this.$PhotoLogger3(i.LOADED,{uri:l});m.release();}.bind(this)),g.listen(n,'error',function(){this.$PhotoLogger3(i.ERROR,{uri:l});m.release();}.bind(this)),g.listen(n,'abort',function(){this.$PhotoLogger3(i.ABORT,{uri:l});m.release();}.bind(this)));n.src=l;};k.prototype.logEvent=function(l){"use strict";this.$PhotoLogger3(l);};k.prototype.$PhotoLogger3=function(l,m){"use strict";var n=new h('photos_client_loading',null,{addBrowserFields:true});n.addNormal('event',l);n.addNormal('viewer',this.$PhotoLogger0);for(var o in m)n.addNormal(o,m[o]);n.post();};e.exports=k;},null);
__d("PhotoSessionLog",["AsyncRequest","Run","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){function k(){}j(k,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(l){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=l;this.buttonLikes=0;this.pagingAction='';this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;this.panoramaClicks=0;this.panoramaImpressions=0;if(l===k.SNOWLIFT){var m=i.getViewportDimensions();this.width=m.x;this.height=m.y;}},setLogFbids:function(l){this.logIds=l;},setPhotoSet:function(l){this.set=l;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(l){this.pagingAction=l;},setCycle:function(l){this.cycle=l;},setEndOfRelevant:function(l){this.endOfRelevant=l;},setRelevantCount:function(l){this.relevantCount=l;},setEndMetrics:function(l){this.endMetrics=l;},setSource:function(l){this.source=l;},addPanoramaClick:function(){this.panoramaClicks++;},addPanoramaImpression:function(){this.panoramaImpressions++;},addPhotoView:function(l,m,n){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(l)this.fbidList.push([l.fbid,l.owner,Date.now()]);if(m)this.hiResLoads++;if(n)this.fullScreenViews[l.fbid]=true;},logEnterFullScreen:function(l){this.fullScreenViews[l]=true;},addDetailData:function(l,m){if(!this.details[l])this.details[l]={t:m.num_tags,l:m.has_location,c:m.has_caption,cm:m.comment_count,lk:m.like_count,w:m.width,h:m.height,ad:'{}',p:this.pagingAction};},updateAdData:function(l,m){if(this.details[l])this.details[l].ad=JSON.stringify(m);},logPhotoViews:function(l){if(!this.views)return;if(l!=this.AGGREGATE)this.last=true;var m={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:l?l:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,panorama_clicks:this.panoramaClicks,panorama_impressions:this.panoramaImpressions};if(this.version===k.SNOWLIFT){var n=i.getViewportDimensions();m.width=n.x||this.width;m.height=n.y||this.height;if(this.hiResLoads>0)m.hires_loads=this.hiResLoads;if(this.last){var o=Object.keys(this.fullScreenViews).length;if(o>0)m.fullscreen=o;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(l!=k.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(m).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});h.onUnload(function(){k.logPhotoViews(k.UNLOAD);});h.onLeave(function(){k.logPhotoViews(k.LEAVE);});e.exports=k;},null);
__d("PhotosUtils",["copyProperties","Vector"],function(a,b,c,d,e,f,g,h){function i(){}g(i,{getNearestBox:function(j,k){var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n;}}}return m;},absoluteToNormalizedPosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain='pure';return n;},normalizedToAbsolutePosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain='document';return n;},isFacebox:function(j){return j.match(/^face:/);},isTag:function(j){return j.match(/^tag:/);}});e.exports=i;},null);
__d("PhotoPermalinkURI",[],function(a,b,c,d,e,f){var g={isValid:function(h){return g.parse(h)!==null;},parse:function(h){if(this.isValidLegacy(h)){var i=h.getQueryData();if(i.fbid)return {photo_id:i.fbid,set_token:i.set};if(i.id&&i.pid)return {photo_id:i.id+':'+i.pid,set_token:i.set};return null;}var j=h.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);var k=j.split('/');if(k.length>=3&&k[2]==='photos')if(k.length===4&&/^\d+$/.exec(k[3])!==null){return {photo_id:k[3],set_token:null};}else if(k.length===5&&/^\d+$/.exec(k[4])!==null)return {photo_id:k[4],set_token:k[3]};return null;},isValidLegacy:function(h){var i=h.getPath();if(i[i.length-1]==='/')i=i.substring(0,i.length-1);if(i==='/photo.php'||i==='/force_photo/photo.php'||i==='/photo'||i==='/force_photo/photo/index.php'||i==='/photo/index.php'||i==='/force_photo/photo')return true;return false;}};e.exports=g;},null);
__d("AssertionError",["ManagedError"],function(a,b,c,d,e,f,g){function h(i){g.prototype.constructor.apply(this,arguments);}h.prototype=new g();h.prototype.constructor=h;e.exports=h;},null);
__d("Assert",["AssertionError","sprintf"],function(a,b,c,d,e,f,g,h){function i(n,o){if(typeof n!=='boolean'||!n)throw new g(o);return n;}function j(n,o,p){var q;if(o===undefined){q='undefined';}else if(o===null){q='null';}else{var r=Object.prototype.toString.call(o);q=/\s(\w*)/.exec(r)[1].toLowerCase();}i(n.indexOf(q)!==-1,p||h('Expression is of type %s, not %s',q,n));return o;}function k(n,o,p){i(o instanceof n,p||'Expression not instance of type');return o;}function l(n,o){m['is'+n]=o;m['maybe'+n]=function(p,q){if(p!=null)o(p,q);};}var m={isInstanceOf:k,isTrue:i,isTruthy:function(n,o){return i(!!n,o);},type:j,define:function(n,o){n=n.substring(0,1).toUpperCase()+n.substring(1).toLowerCase();l(n,function(p,q){i(o(p),q);});}};['Array','Boolean','Date','Function','Null','Number','Object','Regexp','String','Undefined'].forEach(function(n){l(n,j.bind(null,n.toLowerCase()));});e.exports=m;},null);
__d("PhotoSnowliftAds",["Arbiter","Event","copyProperties","CSS","csx","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector","extendArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(t,u){if(u)this.adsStatus=t;var v=Date.now();this.adsEvents[t+'_'+v]=v;},init:function(t,u,v,w){this.reset();this.root=t;this.snowlift=u;this.minAds=v.min_ads;this.displayedCallback=w;this.addEvent('init',true);},reset:function(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(t){this.availableDimensions=t;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(t,u,v){var w={};t.forEach(function(x){var y=x.root.firstChild.offsetHeight;x.units.forEach(function(aa){if(!j.hasClass(aa,'hidden')&&!this.getIsHoldout(aa)&&!this.getIsShadow(aa)){var ba=this.getHeight(aa.firstChild,u);y-=ba;}}.bind(this));var z={height:y,visible:false};x.units.forEach(function(aa){var ba=this.getIsAds(aa),ca=this.getHeight(aa.firstChild,u),da=this.getUnitId(aa),ea=this.getIsHoldout(aa);if(ea&&v)return;w[da]={height:ca,visible:false,priority:0,is_ads:ba,is_holdout:ea,section_ref:z};}.bind(this));}.bind(this));return w;},calculateVisibleUnits:function(t,u,v){var w=0,x=this.getUnitPriority(u);x.forEach(function(y){if(u.hasOwnProperty(y)){var z=u[y],aa=z.height;if(!z.section_ref.visible)aa+=z.section_ref.height;z.height_below=v-aa;z.visible=z.height_below>=0&&aa>0;if(z.visible){z.section_ref.visible=true;v-=aa;w++;}}}.bind(this));return u;},displayUnits:function(t,u){t.forEach(function(v){var w=false,x=true;v.units.forEach(function(y){var z=this.getUnitId(y),aa=u[z];if(!aa)return;var ba=aa.visible,ca=aa.height_below,da=aa.is_ads;j.conditionClass(y,'hidden',!ba);if(da&&ba&&x){var ea=m.find(y,'div.ego_unit');j.addClass(ea,'ego_unit_no_top_border');x=false;}w=w||ba;this.calcUnitStats(this.units[da][z],ba,ca);}.bind(this));j.conditionClass(v.root,'hidden',!w);}.bind(this));g.inform('PhotoSnowliftAds/displayUnits');},getUnitsDisplayed:function(t,u){var v=0;t.forEach(function(w){w.units.forEach(function(x){var y=this.getUnitId(x),z=u[y];if(!z||!z.visible)return;v++;}.bind(this));}.bind(this));return v;},getHeightsRequired:function(t,u){var v=0,w=[];t.forEach(function(x){var y=false;x.units.forEach(function(z){var aa=this.getUnitId(z),ba=u[aa];if(!ba)return;v+=ba.height;if(!y){v+=ba.section_ref.height;y=true;}w.push(v);}.bind(this));}.bind(this));return w;},getUnitPriority:function(t){var u=[],v=0,w=0;for(var x in t){var y=t[x];u.push(x);var z=this.minAds+v+w;if(y.is_ads){if(w<this.minAds)z=w;w++;}else v++;y.priority=z;}u=u.sort(function(aa,ba){var ca=t[aa],da=t[ba];return ca.priority-da.priority;}.bind(this));return u;},updateUnitsStatus:function(){var t=this.availableDimensions.x,u=this.availableDimensions.y,v=this.calculateUnitSizes(this.sections,t);v=this.calculateVisibleUnits(this.sections,v,u);for(var w in v){if(!v.hasOwnProperty(w))continue;var x=v[w];if(!x.is_holdout||!x.visible)continue;var y=this.units[1][w];this.calcUnitStats(y,x.visible,x.height_below);}v=this.calculateUnitSizes(this.sections,t,true);v=this.calculateVisibleUnits(this.sections,v,u);this.displayUnits(this.sections,v);if(this.displayedCallback){var z=this.getUnitsDisplayed(this.sections,v),aa=this.getHeightsRequired(this.sections,v);this.displayedCallback(z,aa);}},calcUnitStats:function(t,u,v){var w=Date.now();if(t.visible)t.totalTime+=w-t.lastShowTime;if(t.trackingCode!==null&&t.totalTime>=this.UNITS_REGISTER_DELAY){var x=t.trackingCode;t.trackingCode=null;this.registerImpression(x,t.registerUrl);}t.visible=u;t.heightBelow=v;t.lastShowTime=w;},prepareResize:function(){var t=function(u){var v=m.create('div',{className:'inner'}),w=m.create('div',{className:'wrapper'},v);m.replace(u,w);m.setContent(v,u);return w;};this.sections=m.scry(this.root,'div.ego_section').map(function(u){return {root:t(u),units:m.scry(u,'div.ego_unit').map(t)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var t=this.nextRegisterTime();if(t!==Infinity)setTimeout(this.processResize.bind(this),t);},setIsLogAdData:function(t){this.isLogAdData=t;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var t=this.snowlift.getImageId();if(this.isLogAdData&&t){var u=q.getElementDimensions(this.snowlift.getImage()),v=q.getElementDimensions(this.snowlift.getRHCHeader()),w=q.getElementDimensions(this.snowlift.getRHCBody()),x=q.getElementDimensions(this.snowlift.getRHCFooter()),y={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:u.x,image_y:u.y,header_x:v.x,header_y:v.y,body_x:w.x,body_y:w.y,footer_x:x.x,footer_y:x.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};n.updateAdData(t,y);}},getAdsBelowSpace:function(){var t=[],u=this.units[1];for(var v in u)if(u.hasOwnProperty(v)&&!this.getIsHoldout(this.getAdUnit(v)))t.push(u[v].heightBelow);return t;},getIsAds:function(t){var u=m.scry(t,"div._4u8");return u.length;},getUnitId:function(t){if(this.getIsAds(t)){return this.getAdId(t);}else return this.getEgoId(t);},getEgoId:function(t){var u=m.find(t,'div.ego_unit');return u.getAttribute('data-ego-fbid');},getAdData:function(t){var u=m.find(t,"div._4u8"),v=u.getAttribute('data-ad');return v&&JSON.parse(v)||{};},getAdId:function(t){return this.getAdData(t).adid;},getIsHoldout:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).holdout;},getIsShadow:function(t){return t&&this.getIsAds(t)&&this.getAdData(t).shadow;},getAdUnit:function(t){if(!this.sections)return null;var u=[];this.sections.forEach(function(w){r(u,w.units);});for(var v=0;v<u.length;v++)if(this.getIsAds(u[v])&&this.getAdId(u[v])==t)return u[v];return null;},nextRegisterTime:function(){var t=Infinity,u=i(i({},this.units[0]),this.units[1]);for(var v in u)if(u.hasOwnProperty(v)){var w=u[v];if(w.trackingCode!==null&&w.visible)t=Math.min(t,this.UNITS_REGISTER_DELAY-w.totalTime);}return t;},getHeight:function(t,u){var v=l.get(t,'height');if(v&&v.x===u)return v.y;return this.cacheHeight(t,u);},cacheHeight:function(t,u){var v={x:u,y:t.offsetHeight};l.set(t,'height',v);return v.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);this.position++;var t=this.getCursorFBID(this.loadQuery);o.loadFromEndpoint('WebEgoPane',this.root,{pid:34,data:[this.loadQuery.set,t,false,this.snowlift.getOpaqueCursor(t)]},{crossPage:true,bundle:false});},getCursorFBID:function(t){if(t.v!==undefined)return t.v;if(t.fbid!==undefined)return t.fbid;return '0';},unitsLoaded:function(t,u){var v;if(u){v='/ai.php';this.addEvent('adsLoaded',true);}else{v='/ajax/ei.php';this.addEvent('egoLoaded',true);}var w={};for(var x in t)if(t.hasOwnProperty(x))w[x]={trackingCode:t[x],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:v};this.units[u]=w;if(u)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();j.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var t=Date.now()-this.lastLoadTime;if(!this.isLoading&&t>s.REFRESH_RATE){j.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(t,u){var v=m.create('iframe',{src:p(u).addQueryData({aed:t}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});v.setAttribute('aria-hidden','true');m.appendContent(this.root,v);},waitForImages:function(t){var u=m.scry(this.root,'img.img'),v=u.length,w=v;if(w===0)t();var x=function(){w--;if(w===0)setTimeout(t,0);};for(var y=0;y<v;y++){var z=u[y];if(z.complete){x();}else h.listen(z,{load:x,error:x,abort:x});}}};e.exports=s;},null);
__d("PhotoTagSearchPivotLogger",["Banzai"],function(a,b,c,d,e,f,g){var h={};g.subscribe(g.SHUTDOWN,function(){Object.keys(h).forEach(function(l){var m=h[l];Object.keys(m).forEach(function(n){g.post('photo_tag_search_pivot',{source:l,action:n,count:m[n]});});});});var i=/^(perm:)?tag:/,j,k={logImpression:function(l,m){var n=l in h?h[l]:(h[l]={});n[m]=m in n?n[m]+1:1;},logImageImpression:function(l,m,n){if(j!==m){if(n.some(function(o){return i.test(o);}))this.logImpression(l,'image_impression');j=m;}},logPivotImpression:function(l,m){if(i.test(m))this.logImpression(l,'pivot_impression');},logShowMorePhotos:function(){this.logImpression('photoset','show_more_photos');},logHideMorePhotos:function(){this.logImpression('photoset','hide_more_photos');},logSuggestMorePhotos:function(){this.logImpression('photoset','suggest_more_photos');},logMorePhotosNavigation:function(l){g.post('photo_tag_search_pivot',{source:'photoset',action:'more_photos_search',query:l,count:1});}};e.exports=k;},null);
__d("PhotoViewer",["Bootloader","CSS","DOM","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k){function l(){"use strict";this.image=null;this.root=null;this.stream=null;}l.prototype.getEventString=function(m){"use strict";var n=this.getEventPrefix();if(n)return n+'.'+m;return null;};l.prototype.getImage=function(){"use strict";return this.image;};l.prototype.getPosition=function(){"use strict";return this.stream?this.stream.getCursor():null;};l.prototype.getRoot=function(){"use strict";return this.root;};l.prototype.hiliteAllBoxes=function(){"use strict";i.scry(this.stageWrapper,'div.tagsWrapper div.faceBox').forEach(function(m){h.addClass(m,'otherActive');});};l.bootstrap=function(m,n){"use strict";g.loadModules(["PhotoSnowlift"],function(o){o.bootstrap(m,n);});};j(l.prototype,{getEventPrefix:k.thatReturnsNull,getSourceString:k.thatReturnsNull,getVersionConst:k.thatReturnsNull,getViewerSource:k.thatReturnsNull,getViewerSet:k.thatReturnsNull});e.exports=l;},null);
__d("PhotosetSearchPivot.react",["LeftRight.react","PhotoTagSearchPivotLogger","PhotosetSearchPivotData","React","XUISpinner.react","XUIText.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=j.createClass({displayName:'PhotosetSearchPivotItem',propTypes:{normalized:j.PropTypes.string,title:j.PropTypes.string,uri:j.PropTypes.string,images:j.PropTypes.array},onClick:function(){h.logMorePhotosNavigation(this.props.normalized);},render:function(){return (j.createElement(j.DOM.div,{className:"_25r"},j.createElement(j.DOM.a,{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},j.createElement(j.DOM.div,{className:"_25u"},j.createElement(j.DOM.div,{className:"_25v _25w",style:{backgroundImage:'url('+this.props.images[0].uri+')'}}),j.createElement(j.DOM.div,{className:"_25x"},j.createElement(j.DOM.div,{className:"_25y"},j.createElement(j.DOM.div,{className:"_25z"}),j.createElement(j.DOM.div,{className:"_26r"},j.createElement(j.DOM.div,{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[1].uri+')'}}))),j.createElement(j.DOM.div,{className:"_274"},j.createElement(j.DOM.div,{className:"_25z"}),j.createElement(j.DOM.div,{className:"_26r"},j.createElement(j.DOM.div,{className:"_273 _25w",style:{backgroundImage:'url('+this.props.images[2].uri+')'}}))))),j.createElement(l,{display:"block",className:"_27f _2pi4"},this.props.title))));}}),p=j.createClass({displayName:'PhotosetSearchPivot',propTypes:{fbid:j.PropTypes.string,endofalbum:j.PropTypes.bool},fetchPivots:function(q){i.fetch(q).then(function(r){var s=r.pivots;setTimeout(function(){this.setState({pivots:s||[],action:'show'});}.bind(this),0);}.bind(this),function(r){setTimeout(function(){this.setState({pivots:[],action:'show'});}.bind(this),0);}.bind(this));},getInitialState:function(){this.fetchPivots(this.props.fbid);return {pivots:[],action:'loading'};},componentWillReceiveProps:function(q){if(q.fbid){this.setState({action:'loading'});this.fetchPivots(q.fbid);}else{this.setState({action:'hide'});setTimeout(function(){if(this.state.action==='hide')this.setState({pivots:[],action:''});}.bind(this),1000);}},onExitClicked:function(){this.props.onclose();},render:function(){if(this.state.action==='loading')return (j.createElement(j.DOM.div,{className:"_27g _27h _2ph_"},j.createElement(k,{size:"large"})));if(this.state.pivots.length===0&&this.state.action!=='show')return j.createElement(j.DOM.span,null);var q;if(this.state.pivots.length>0){q=this.state.pivots.map(function(s){return (j.createElement(o,{normalized:s.normalized,title:s.title,uri:s.uri,images:s.images}));});}else q=j.createElement(j.DOM.div,{className:"_27i"},"Unfortunately, there doesn't seem to be any other relevant photos available.");var r=this.props.endofalbum?j.createElement(j.DOM.span,{className:"_2pij"},"End of album"):null;return (j.createElement(j.DOM.div,{className:(("_27g")+(this.state.action==='hide'?' '+"_27j":'')+(this.state.action==='show'?' '+"_27k":''))},j.createElement(j.DOM.div,{className:"_27l"},j.createElement(g,{className:"_27m _2pi3 _2pib"},j.createElement(j.DOM.span,null,r,j.createElement(j.DOM.span,{className:"_4ptz"},"Other photos you may like")),j.createElement(j.DOM.a,{href:"#",onClick:this.onExitClicked,className:"_27n"})),j.createElement(j.DOM.div,{className:"_27o _2pi8 clearfix"},q))));}});e.exports=p;},null);
__d("logVideosClickTracking",["clickRefAction"],function(a,b,c,d,e,f,g){function h(i){g('click',i,null,'FORCE');}e.exports=h;},null);
__d("VideoCTAEndscreen",["CSS","DOM","Event","VideoPlayerReason","SubscriptionsHandler","VideoPlayerLoggerEvents","VideoPlayerReason","csx","logVideosClickTracking"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(q,r){"use strict";this.$VideoCTAEndscreen0=q;this.$VideoCTAEndscreen1=r.endscreenElement;this.$VideoCTAEndscreen2=r.replayElement||h.find(this.$VideoCTAEndscreen1,"._5j_6");this.$VideoCTAEndscreen3=new k();if(this.$VideoCTAEndscreen2!=null)this.$VideoCTAEndscreen3.addSubscriptions(i.listen(this.$VideoCTAEndscreen2,'click',function(){return this.$VideoCTAEndscreen4();}.bind(this)));if(q.addListener)this.$VideoCTAEndscreen3.addSubscriptions(q.addListener('finishPlayback',function(){return this.$VideoCTAEndscreen5();}.bind(this)),q.addListener('beginPlayback',function(){return this.$VideoCTAEndscreen6();}.bind(this)));}p.prototype.$VideoCTAEndscreen4=function(){"use strict";var q={reason:j.USER};this.$VideoCTAEndscreen0.logEvent(l.REPLAYED,q);o(this.$VideoCTAEndscreen0.getVideoNode());this.$VideoCTAEndscreen0.play(m.USER);};p.prototype.$VideoCTAEndscreen5=function(){"use strict";g.show(this.$VideoCTAEndscreen1);};p.prototype.$VideoCTAEndscreen6=function(){"use strict";g.hide(this.$VideoCTAEndscreen1);};p.prototype.handleFlashEvent=function(q,r){"use strict";if(this.$VideoCTAEndscreen1==null)return;if(!this.$VideoCTAEndscreen0.addListener)switch(q){case 'flash/beginPlayback':this.$VideoCTAEndscreen6();break;case 'flash/finishPlayback':this.$VideoCTAEndscreen5();break;}};e.exports=p;},null);
__d("VideoPlayerApiEvents",[],function(a,b,c,d,e,f){var g=['buffered','buffering','beginPlayback','updateStatus','logEvent','pausePlayback','clickForTracking','finishPlayback','unmuteVideo','openLargeFormat','turnOffAutoplay','expandVideo'];e.exports=g;},null);
__d("AbstractVideoPlayerApi",["EventEmitter","VideoPlayerApiEvents","arrayContains","invariant"],function(a,b,c,d,e,f,g,h,i,j){for(var k in g)if(g.hasOwnProperty(k))m[k]=g[k];var l=g===null?null:g.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=g;function m(){"use strict";l.constructor.call(this);}m.prototype.addListener=function(){"use strict";var n=Array.prototype.slice.call(arguments,0);return l.addListener.apply(this,n);};m.prototype.emit=function(){"use strict";var n=Array.prototype.slice.call(arguments,0);return l.emit.apply(this,n);};e.exports=m;},null);
__d("VideoPlayerFlashApi",["AbstractVideoPlayerApi","Arbiter","DOMQuery","SubscriptionsHandler","VideoPlayerApiEvents","destroyOnUnload","invariant"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(s){if(s.hasAttribute('data-flash'))return s.getAttribute('id');return i.find(s,'div[data-flash]').getAttribute('id');}function o(s){var t=i.scry(s,'embed');if(!t.length)t=i.scry(s,'object');m(t.length);return t[0];}for(var p in g)if(g.hasOwnProperty(p))r[p]=g[p];var q=g===null?null:g.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=g;function r(s,t){"use strict";q.constructor.call(this);this.$VideoPlayerFlashApi0=o(s);this.$VideoPlayerFlashApi1=n(s);this.$VideoPlayerFlashApi2=new j();this.$VideoPlayerFlashApi2.addSubscriptions(h.subscribe(k.map(function(u){return 'flash/'+u;}),this.$VideoPlayerFlashApi3.bind(this)));l(function(){return this.$VideoPlayerFlashApi2.release();}.bind(this));this.$VideoPlayerFlashApi4=t;}r.onImplementationReady=function(s,t){"use strict";var u=n(s),v=h.subscribe('flash/ready',function(w,x){if(x.divID===u){h.unsubscribeCurrentSubscription();h.releaseCurrentPersistentEvent();t(s);}});l(function(){return v.unsubscribe();});};r.prototype.$VideoPlayerFlashApi3=function(s,t){"use strict";if(t.divID!==this.$VideoPlayerFlashApi1)return;var u=s.substr('flash/'.length);this.emit(u,t);};r.prototype.pause=function(){"use strict";var s=Array.prototype.slice.call(arguments,0);this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.pauseVideo,s);};r.prototype.play=function(){"use strict";var s=Array.prototype.slice.call(arguments,0);this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.playVideo,s,true);};r.prototype.seek=function(){"use strict";var s=Array.prototype.slice.call(arguments,0);this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.seekVideo,s);};r.prototype.setScriptPath=function(){"use strict";var s=Array.prototype.slice.call(arguments,0);this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.setScriptPath,s);};r.prototype.setFTData=function(){"use strict";var s=Array.prototype.slice.call(arguments,0);this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.setFTData,s);};r.prototype.switchVideo=function(){"use strict";var s=Array.prototype.slice.call(arguments,0);this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.switchVideo,s);};r.prototype.unmute=function(){"use strict";var s=Array.prototype.slice.call(arguments,0);this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.unmuteVideo,s);};r.prototype.getVideoInfo=function(){"use strict";var s=Array.prototype.slice.call(arguments,0),t=this.$VideoPlayerFlashApi5(this.$VideoPlayerFlashApi0.getVideoInfo,s,false);return JSON.parse(t);};r.prototype.$VideoPlayerFlashApi5=function(s,t,u){"use strict";try{return s.apply(this.$VideoPlayerFlashApi0,t);}catch(v){this.$VideoPlayerFlashApi4&&this.$VideoPlayerFlashApi4(v,u);}};e.exports=r;},null);
__d("HTMLMediaElementReadyStates",[],function(a,b,c,d,e,f){var g={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4};e.exports=g;},null);
__d("onCanPlayHTMLMediaElement",["EventListener","HTMLMediaElementReadyStates","emptyFunction","invariant","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n){j(m instanceof window.HTMLMediaElement);if(m.readyState===h.HAVE_FUTURE_DATA){k(n);return {remove:i};}else return g.listen(m,'canplay',n);}e.exports=l;},null);
__d("VideoPlayerHTML5Api",["AbstractVideoPlayerApi","Arbiter","EventListener","SubscriptionsHandler","destroyOnUnload","onCanPlayHTMLMediaElement"],function(a,b,c,d,e,f,g,h,i,j,k,l){for(var m in g)if(g.hasOwnProperty(m))o[m]=g[m];var n=g===null?null:g.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=g;function o(p){"use strict";n.constructor.call(this);this.$VideoPlayerHTML5Api0=p;this.$VideoPlayerHTML5Api1=p.id;this.$VideoPlayerHTML5Api2=new j();k(function(){return this.$VideoPlayerHTML5Api2.release();}.bind(this));this.$VideoPlayerHTML5Api3();}o.prototype.getDOMElement=function(){"use strict";return this.$VideoPlayerHTML5Api0;};o.onImplementationReady=function(p,q){"use strict";var r=l(p,q);k(function(){return r.remove();});};o.prototype.pause=function(p){"use strict";this.$VideoPlayerHTML5Api0.pause();};o.prototype.play=function(p){"use strict";this.$VideoPlayerHTML5Api0.play();};o.prototype.seek=function(p){"use strict";};o.prototype.setFTData=function(p){"use strict";};o.prototype.switchVideo=function(p){"use strict";};o.prototype.unmute=function(){"use strict";this.$VideoPlayerHTML5Api0.muted=false;};o.prototype.$VideoPlayerHTML5Api3=function(){"use strict";this.$VideoPlayerHTML5Api2.addSubscriptions(i.listen(this.$VideoPlayerHTML5Api0,'playing',function(){this.$VideoPlayerHTML5Api4('flash/beginPlayback');}.bind(this)),i.listen(this.$VideoPlayerHTML5Api0,'ended',function(){this.$VideoPlayerHTML5Api4('flash/finishPlayback');}.bind(this)),i.listen(this.$VideoPlayerHTML5Api0,'pause',function(){this.$VideoPlayerHTML5Api4('flash/pausePlayback');}.bind(this)));};o.prototype.$VideoPlayerHTML5Api4=function(event){"use strict";h.inform(event,{divID:this.$VideoPlayerHTML5Api1});this.inform(event.substr('flash/'.length));};e.exports=o;},null);
__d("VideoPlayerApiFactory",["VideoPlayerFlashApi","VideoPlayerHTML5Api"],function(a,b,c,d,e,f,g,h){var i={create:function(j,k){var l=this._getImplementationModule(j);return new l(j,k);},_getImplementationModule:function(j){var k=null;if(j.tagName==='VIDEO'){k=h;}else k=g;return k;},onImplementationReady:function(j,k){var l=this._getImplementationModule(j);l.onImplementationReady(j,function(m){return k(m,l);});}};e.exports=i;},null);
__d("VideoPlayerController",["Banzai","DOMDimensions","EventEmitter","Flash","ScriptPath","SubscriptionsHandler","VideoCTAEndscreen","VideoPlayerApiEvents","VideoPlayerApiFactory","VideoPlayerLogger","VideoPlayerLoggerErrors","VideoPlayerLoggerErrorStates","VideoPlayerLoggerEvents","VideoPlayerVersions","VideoPlayerReason","arrayContains","collectDataAttributes","emptyFunction","getElementPosition","invariant","logVideosClickTracking","mergeInto"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){for(var ca in i)if(i.hasOwnProperty(ca))ea[ca]=i[ca];var da=i===null?null:i.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=i;function ea(fa,ga){"use strict";var ha=fa.video_id,ia=fa.video_ids,ja=fa.source,ka=fa.ad_client_token,la=fa.should_autoplay,ma=fa.player_version,na=fa.autoplay_setting,oa=fa.additional_logdata_getter,pa=ga.root_element,qa=ga.cta_endscreen,ra=ga.cta_replay_element,sa=ga.video_element;da.constructor.call(this);this.$VideoPlayerController0=0;this.$VideoPlayerController1=la;this.$VideoPlayerController2=na;this.$VideoPlayerController3=ka;this.$VideoPlayerController4=ma;this.$VideoPlayerController5=sa;this.$VideoPlayerController6=pa;this.$VideoPlayerController7=false;this.$VideoPlayerController8=ha;this.$VideoPlayerController9=ia||[ha];this.$VideoPlayerControllera=oa||{get:x};this.$VideoPlayerControllerb=null;this.$VideoPlayerControllerc=null;this.$VideoPlayerControllerd=new p(ja);this.$VideoPlayerControllerd.setFTData(w(this.getRootNode(),['ft']));this.$VideoPlayerControllerd.setScriptPath(k.getScriptPath());this.$VideoPlayerControllere=false;this.setState('loading');if(this.isImplementationUnavailable()){this.$VideoPlayerControllerf();return;}if(qa)this.$VideoPlayerControllerg=new m(this,{endscreenElement:qa,replayElement:ra});o.onImplementationReady(this.getVideoNode(),function(){return this.onApiReady();}.bind(this));g.subscribe(g.SHUTDOWN,function(){this.logStopForUnload();}.bind(this));if(this.$VideoPlayerController1)this.play(u.AUTOPLAY);}ea.prototype.setAdditionalLogDataGetter=function(fa){"use strict";this.$VideoPlayerControllera=fa;};ea.prototype.logStopForUnload=function(){"use strict";if(this.$VideoPlayerControllerb!==null&&this.$VideoPlayerControllerc!==null){var fa={reason:'unloaded',video_time_position:this.$VideoPlayerControllerb,video_last_start_time_position:this.$VideoPlayerControllerc};if(this.getOriginalPlayReason())fa.original_play_reason=this.getOriginalPlayReason();this.logEvent(s.PAUSED,fa);this.resetPositions();}else this.cancelPlayRequest();};ea.prototype.isImplementationUnavailable=function(){"use strict";return !this.isPlayerVersion(t.HTML5)&&!j.isAvailable();};ea.prototype.$VideoPlayerControllerf=function(){"use strict";var fa={error:q.ERROR_CALLING_FLASH,state:r.PLAYER_FAILURE};this.logEvent(s.ERROR,fa);this.$VideoPlayerController1=false;};ea.prototype.handleFlashApiFactoryError=function(fa,ga){"use strict";var ha={error:q.ERROR_CALLING_FLASH,error_description:fa.message,state:ga?r.PLAYBACK_FAILURE:r.PLAYER_FAILURE};this.logEvent(s.ERROR,ha);if(ga&&this.$VideoPlayerControllere)this.$VideoPlayerControllere=false;};ea.prototype.isPlayRequestPending=function(){"use strict";return this.$VideoPlayerControllere;};ea.prototype.play=function(fa){"use strict";if(!this.$VideoPlayerControllerh)this.$VideoPlayerControllerh=fa;if(!this.$VideoPlayerControllere){var ga=this.$VideoPlayerControlleri({reason:fa});this.logEvent(s.REQUESTED_PLAYING,ga);}this.sendPlayRequest(fa);};ea.prototype.sendPlayRequest=function(fa){"use strict";if(this.isState('fallback')){this.emit('fallbackPlay');return;}this.$VideoPlayerControllere=true;if(this.isState('loading')){this.$VideoPlayerControllerj={reason:fa};}else this.getVideoAPI().play(fa);};ea.prototype.getOriginalPlayReason=function(){"use strict";return this.$VideoPlayerControllerh;};ea.prototype.reset=function(){"use strict";if(this.isState('loading')||this.isState('fallback'))return;this.resetPositions();this.$VideoPlayerControllerk();this.$VideoPlayerControllerl=null;this.setState('loading');o.onImplementationReady(this.getVideoNode(),function(){return this.onApiReady();}.bind(this));};ea.prototype.cancelPlayRequest=function(){"use strict";if(this.$VideoPlayerControllere){var fa={reason:this.getOriginalPlayReason()};this.$VideoPlayerControllere=false;this.logEvent(s.CANCELLED_REQUESTED_PLAYING,fa);}};ea.prototype.getVideoAPI=function(){"use strict";return this.$VideoPlayerControllerl;};ea.prototype.getVideoNode=function(){"use strict";return this.$VideoPlayerController5;};ea.prototype.getRootNode=function(){"use strict";return this.$VideoPlayerController6;};ea.prototype.onApiReady=function(fa){"use strict";this.$VideoPlayerControllerl=o.create(this.getVideoNode(),this.handleFlashApiFactoryError.bind(this));this.setState('ready');this.$VideoPlayerControllerm();this.setFTDataForCasablanca();this.setScriptPathForCasablanca();if(this.$VideoPlayerControllerj){this.sendPlayRequest(this.$VideoPlayerControllerj.reason);this.$VideoPlayerControllerj=null;}if(this.$VideoPlayerControllern){this.getVideoAPI().unmute();this.$VideoPlayerControllern=null;}var ga={is_auto_played:this.isAutoplayable()};if(fa)ga.init_delay=fa;this.logEvent(s.PLAYER_LOADED,ga);};ea.prototype.resetPositions=function(){"use strict";this.$VideoPlayerControllerb=null;this.$VideoPlayerControllerc=null;};ea.prototype.$VideoPlayerControllero=function(fa){"use strict";this.$VideoPlayerControllere=false;if(fa!==undefined)this.$VideoPlayerControllerc=fa;this.setState('playing');};ea.prototype.$VideoPlayerControllerp=function(fa){"use strict";if(fa!==undefined)this.$VideoPlayerControllerb=fa;};ea.prototype.$VideoPlayerControllerq=function(fa){"use strict";var event=fa.event;delete fa.event;this.logEvent(event,fa);};ea.prototype.$VideoPlayerControllerr=function(){"use strict";this.resetPositions();if(!this.isState('finished'))this.setState('paused');};ea.prototype.$VideoPlayerControllers=function(){"use strict";this.resetPositions();this.setState('finished');};ea.prototype.getVideosCount=function(){"use strict";return this.$VideoPlayerController9.length;};ea.prototype.$VideoPlayerControllert=function(){"use strict";var fa=this.getVideosCount();return (this.$VideoPlayerController0+1)%fa;};ea.prototype.$VideoPlayerControlleru=function(){"use strict";var fa=this.getVideosCount();return (this.$VideoPlayerController0-1+fa)%fa;};ea.prototype.$VideoPlayerControllerv=function(fa){"use strict";this.logEvent(s.CAROUSEL_CHANGE,{source_index:this.$VideoPlayerController0,target_index:fa});this.getVideoAPI().switchVideo(fa);this.$VideoPlayerController0=fa;this.emit('switchVideo');};ea.prototype.unmute=function(){"use strict";if(!this.isState('loading')){this.getVideoAPI().unmute();}else this.$VideoPlayerControllern=true;};ea.prototype.nextVideo=function(){"use strict";this.$VideoPlayerControllerv(this.$VideoPlayerControllert());};ea.prototype.previousVideo=function(){"use strict";this.$VideoPlayerControllerv(this.$VideoPlayerControlleru());};ea.prototype.getVideoIndex=function(){"use strict";return this.$VideoPlayerController0;};ea.prototype.getVideoID=function(){"use strict";return this.$VideoPlayerController9[this.getVideoIndex()];};ea.prototype.$VideoPlayerControllerm=function(){"use strict";var fa=this.$VideoPlayerControllerl;this.$VideoPlayerControllerw=new l();var ga=[['buffered',function(){return this.setBuffering(false);}.bind(this)],['buffering',function(){return this.setBuffering(true);}.bind(this)],['beginPlayback',function(ia){return this.$VideoPlayerControllero(ia.position);}.bind(this)],['updateStatus',function(ia){return this.$VideoPlayerControllerp(ia.position);}.bind(this)],['logEvent',function(ia){return this.$VideoPlayerControllerq(ia.logData);}.bind(this)],['pausePlayback',function(){return this.$VideoPlayerControllerr();}.bind(this)],['clickForTracking',function(){return aa(this.getVideoNode());}.bind(this)],['finishPlayback',function(){return this.$VideoPlayerControllers();}.bind(this)]],ha=function(event){return this.emit.bind(this,event);}.bind(this);this.$VideoPlayerControllerw.addSubscriptions.apply(this.$VideoPlayerControllerw,ga.map(function(ia){return fa.addListener.apply(fa,ia);}).concat(n.map(function(event){return fa.addListener(event,ha(event));})));};ea.prototype.$VideoPlayerControllerk=function(){"use strict";if(this.$VideoPlayerControllerw)this.$VideoPlayerControllerw.release();};ea.prototype.seek=function(fa){"use strict";this.getVideoAPI().seek(fa);};ea.prototype.pause=function(fa){"use strict";if(this.isState('loading')){this.$VideoPlayerControllerj=null;}else if(this.isState('playing')){this.getVideoAPI().pause(fa);this.setState('paused');}else if(this.isState('ready'))this.getVideoAPI().pause(fa);this.cancelPlayRequest();};ea.prototype.isPlayerVersion=function(fa){"use strict";return this.$VideoPlayerController4===fa;};ea.prototype.isAutoplayable=function(){"use strict";return this.$VideoPlayerController1;};ea.prototype.isBuffering=function(){"use strict";return this.$VideoPlayerController7;};ea.prototype.setBuffering=function(fa){"use strict";if(fa!==this.$VideoPlayerController7){this.$VideoPlayerController7=fa;if(this.$VideoPlayerController7){this.$VideoPlayerControllerd.startBuffering();}else this.$VideoPlayerControllerd.endBuffering();}};ea.prototype.getDOMPosition=function(){"use strict";return y(this.getRootNode());};ea.prototype.$VideoPlayerControllerx=function(){"use strict";var fa=this.getDOMPosition(),ga=h.getViewportDimensions().height,ha=null;if(fa.y<=0){ha=fa.y;}else if(fa.y+fa.height<ga){ha=0;}else ha=fa.y+fa.height-ga;return {viewport_distance:ha,unit_height:fa.height};};ea.prototype.$VideoPlayerControllery=function(){"use strict";return ba(Object.assign({},this.$VideoPlayerControllerx(),{ad_client_token:this.$VideoPlayerController3,autoplay_eligible:this.isAutoplayable(),autoplay_setting:this.$VideoPlayerController2,player_version:this.$VideoPlayerController4,video_id:this.getVideoID(),player_state:this.$VideoPlayerControllerz}),this.$VideoPlayerControllera.get());};ea.prototype.$VideoPlayerControllerA=function(){"use strict";if(this.isState('loading'))return null;return this.getVideoAPI().getVideoInfo();};ea.prototype.$VideoPlayerControlleri=function(fa){"use strict";var ga=this.$VideoPlayerControllerA();if(ga!=null)return ba({resource_url:ga.urlRequest.url,hls:ga.isHLS,hd:ga.isHD},fa);return fa;};ea.prototype.logEvent=function(event,fa){"use strict";var ga=ba(this.$VideoPlayerControllery(),fa);this.$VideoPlayerControllerd.logEvent(event,ga);};ea.prototype.setFTDataForCasablanca=function(){"use strict";if(this.isPlayerVersion(t.CASABLANCA)){var fa=w(this.getRootNode(),['ft']);this.getVideoAPI().setFTData(JSON.stringify(fa.ft));}};ea.prototype.setScriptPathForCasablanca=function(){"use strict";if(this.isPlayerVersion(t.CASABLANCA))this.getVideoAPI().setScriptPath(k.getScriptPath());};ea.prototype.setState=function(fa){"use strict";if(this.isState('fallback'))return;this.$VideoPlayerControllerz=fa;if(this.$VideoPlayerControllerz==='fallback')this.$VideoPlayerControllerk();this.emit('stateChange');};ea.prototype.isState=function(fa){"use strict";return this.$VideoPlayerControllerz===fa;};ea.playerStates=['finished','loading','paused','playing','ready','fallback'];e.exports=ea;},null);
__d("PhotoSnowlift",["Arbiter","Assert","AsyncRequest","Bootloader","CSS","Dialog","DOM","DOMControl","Event","fbt","FullScreen","ImageUtils","Input","Keys","Layer","LikeConfirmer","LinkController","LitestandStoryInsertionStatus","Locale","PageTransitions","Parent","PhotoLogger","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotoSnowliftAds","PhotoStreamCache","PhotoTagSearchPivotLogger","PhotosetSearchPivotData","PhotosUtils","PhotoViewer","React","Rect","ScriptPath","ScrollableArea","Style","Toggler","Tooltip","UFIFeedbackTargets","UIPagelet","URI","UserAgent_DEPRECATED","Vector","PhotosetSearchPivot.react","VideoPlayerController","VideoPlayerReason","$","asyncCallback","computeRelativeURI","copyProperties","createArrayFrom","csx","cx","emptyFunction","ge","getActiveElement","goURI","tx","userAction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb){var nb=74,ob=75,pb=70,qb=76,rb=315;for(var sb in ka)if(ka.hasOwnProperty(sb))ub[sb]=ka[sb];var tb=ka===null?null:ka.prototype;ub.prototype=Object.create(tb);ub.prototype.constructor=ub;ub.__superConstructor__=ka;function ub(){"use strict";ka.call(this);this._seenTags={};this._navCount=0;this._isZoomOn=false;}ub.prototype.preload=function(vb,wb){"use strict";j.loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(yb){this.PhotoTagger=yb;}.bind(this));var xb=this.getImageSrc(ua(vb).getQueryData());if(xb)if(!this._log(xb))(new Image()).src=xb;};ub.prototype.bootstrap=function(vb,wb){"use strict";if(vb&&ua(vb).getQueryData().makeprofile)this.enableCropperOnInit=true;this.preload(vb,wb);if(this.closeDirty){setTimeout(this.bootstrap.bind(this,vb,wb),0);return;}fa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this._dataFt=null;var xb=aa.byAttribute(wb,'data-cursor');if(xb){try{var zb=JSON.parse(xb.getAttribute('data-ft'));this._dataFt={qid:zb.qid,mf_story_key:zb.mf_story_key};}catch(yb){}}else try{xb=aa.byAttribute(wb,'data-ad');var ac=JSON.parse(xb.getAttribute('data-ad'));this._dataFt={ad_id:ac.adid};}catch(yb){}this.ua=mb('snowlift',wb).uai('open');na.openOverlayView('snowlift');this.returningToStart=false;this.loading&&k.removeClass(this.loading,'loading');if(wb){k.addClass((this.loading=wb),'loading');var bc=aa.byClass(wb,'uiStreamStory')||aa.byClass(wb,"_5jmm");if(bc){this.storyID=bc.id;}else{var cc=aa.byClass(wb,"_5b9c");if(cc)this.storyID=cc.getAttribute('data-ownerid');}this._updateContainerOwnerID();this.getThumbAndSize(wb);}else this.loading=null;g.inform('PhotoSnowlift.GO',vb,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();};ub.prototype._updateContainerOwnerID=function(){"use strict";if(this.container)if(this.storyID){this.container.setAttribute('data-ownerid',this.storyID);}else this.container.removeAttribute('data-ownerid');};ub.prototype.setupFromSnowflake=function(vb,wb){"use strict";this.extraClasses=vb;this.snowflake=true;this.firstInSet=wb;if(this.root){k.addClass(this.root,"snowflake");this.extraClasses.forEach(function(xb){k.addClass(this.root,xb);},this);}};ub.prototype.getCurrentImageServerSizeDimensions=function(){"use strict";var vb=this.stream.getCurrentImageData();return vb.originalDimensions||vb.dimensions;};ub.prototype.getEventPrefix=function(){"use strict";return 'PhotoSnowlift';};ub.prototype.getRoot=function(){"use strict";return this.root;};ub.prototype.getSourceString=function(){"use strict";return 'snowlift';};ub.prototype.getViewerSource=function(){"use strict";return this.source;};ub.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};ub.prototype.getVersionConst=function(){"use strict";return da.VIEWER_SNOWLIFT;};ub.prototype.getImage=function(){"use strict";return this.image;};ub.prototype.getImageId=function(){"use strict";return this.stream.getCursor();};ub.prototype.getRHCHeader=function(){"use strict";return this.rhcHeader;};ub.prototype.getRHCBody=function(){"use strict";return this.ufiForm;};ub.prototype.getRHCFooter=function(){"use strict";return this.rhcFooter;};ub.prototype.getLoadQuery=function(){"use strict";return this.loadQuery;};ub.prototype.getCurrentPhotoInfo=function(){"use strict";var vb=this.stream.getCurrentImageData();if(vb)return vb.info;return null;};ub.prototype.getOwnerId=function(){"use strict";var vb=this.stream.getCurrentImageData();if(vb)return vb.info.owner;return null;};ub.prototype.getThumbAndSize=function(vb){"use strict";this.currentImageSize=null;this.thumbSrc=null;var wb=ua(vb.getAttribute('ajaxify')).getQueryData();if(!wb.size)return;var xb=wa.deserialize(wb.size);if(!xb.x||!xb.y)return;this.currentImageSize=xb;if(vb.getAttribute('data-cropped'))return;var yb=m.scry(vb,'img')[0],zb=m.scry(vb,'i')[0],ac=aa.byAttribute(vb,'data-size');this.shouldStretch=ac&&this.currentImageSize&&yb&&ac.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=ub.TIMELINE_STRETCH_WIDTH&&yb.offsetWidth===ub.TIMELINE_STRETCH_WIDTH;var bc;if(yb){bc=yb.src;}else if(zb){bc=pa.get(zb,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=bc;};ub.prototype.loadFrameIfUninitialized=function(){"use strict";if(this.root)return;new i('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};ub.prototype.init=function(vb,wb){"use strict";this.init=hb;this._shouldLog=wb.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new ba(da.VIEWER_SNOWLIFT_STRING);this._showHover=wb.pivot_hover;this._showMorePhotos=wb.show_more_photos;ea.setEndMetrics(wb.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=q.isSupported();this.showOGVideos=wb.og_videos;this.resizeCommentsForAds=wb.resize_comments_for_ads;this.spotlight=vb;this.spotlight.subscribe('blur',function(){this.closingAction=ea.OUTSIDE;}.bind(this));this.spotlight.subscribe('beforehide',this.beforeCloseHandler.bind(this));this.spotlight.subscribe('hide',this.closeHandler.bind(this));this.spotlight.subscribe('key',this.keyHandler.bind(this));this.initializeNodes(this.spotlight.getRoot());fa.init(this.sideAdUnit,this,wb,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){w.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(xb,yb){this.openExplicitly=true;this.loading&&k.removeClass(this.loading,'loading');this.open(yb);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;z.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)q.subscribe('changed',this.onFullScreenChange.bind(this));this.slideshowGk=wb.snowlift_slideshow;this.buttonTruncateGk=wb.snowlift_button_truncate;this._hasZoomCapability=this._hasZoomCapability&&wb.www_panorama_viewer;this.allowIrrelevantRequests=!!wb.snowlift_allow_irrelevant_requests;if(this.snowflake){k.addClass(this.root,"snowflake");this.extraClasses.forEach(function(xb){k.addClass(this.root,xb);},this);}};ub.prototype.onFullScreenChange=function(){"use strict";var vb=q.isFullScreen();k.conditionClass(document.body,'fbPhotoSnowliftFullScreenMode',vb);if(vb){if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var wb=this.stream.getCurrentImageData();if(wb&&wb.url&&this.image.src!==wb.url&&this.shouldShowHiRes(wb))this.switchImage(wb.url);this.adjustForResize();this._conditionDisplayZoomButton();}else{this.uncollapseRHC();if(va.chrome()&&!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.page(0,false);g.inform('reflow');}qa.hide();if(this.cropper)this.cropper.resetPhoto();};ub.prototype.initializeNodes=function(vb){"use strict";this.root=vb;this.container=m.find(vb,'div.fbPhotoSnowliftContainer');this._updateContainerOwnerID();this.snowliftPopup=m.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=m.find(this.snowliftPopup,'div.rhc');this.rhcHeader=m.find(this.rhc,'div.rhcHeader');this.rhcFooter=m.find(this.rhc,'div.rhcFooter');this.ufiForm=m.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=m.find(this.rhc,'div.fbPhotosSnowboxFeedbackInput');this.scroller=m.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=m.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=m.find(this.snowliftPopup,'div.stageWrapper');this.overlay=m.find(this.snowliftPopup,'div.snowliftOverlay');this.errorBox=m.find(this.stageWrapper,'div.stageError');this.image=m.find(this.stageWrapper,'img.spotlight');this.stage=m.find(this.stageWrapper,'div.stage');this.showZoomButton=m.scry(this.stageWrapper,"._10zt").pop();this.zoomedImage=m.scry(this.stage,"._10zw").pop();this.outerImageSlider=m.scry(this.stage,"._10zx").pop();this.innerImageSlider=m.scry(this.stage,"._10zv").pop();this.zoomOutSwitch=m.scry(this.stageWrapper,"._10zu").pop();this._hasZoomCapability=this.showZoomButton&&this.zoomedImage&&this.outerImageSlider&&this.innerImageSlider&&this.zoomOutSwitch;if(this._hasZoomCapability){k.hide(this.showZoomButton);k.hide(this.zoomedImage);k.hide(this.outerImageSlider);k.hide(this.zoomOutSwitch);}this.videoStage=m.find(this.stageWrapper,'div.videoStage');this.prevPager=m.find(this.snowliftPopup,'a.snowliftPager.prev');this.nextPager=m.find(this.snowliftPopup,'a.snowliftPager.next');this.stageActions=m.find(vb,'div.stageActions');this.buttonActions=m.find(this.stageActions,'div.fbPhotosPhotoButtons');this.placeInfo=m.find(this.rhc,'div.fbPhotosSnowliftPlaceInfo');this.sideAdUnit=m.find(vb,"._5ciw");k.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);};ub.prototype.initializeScroller=function(){"use strict";this.initializeScroller=hb;this.scrollableArea=oa.fromNative(this.scroller,{fade:true,persistent:true});var vb=function(event){var wb=o.$E(event).getTarget();if(m.contains(this.ufiInputContainer,wb)){var xb=n.getInstance(wb);if(xb){this.scrollableArea.scrollToBottom();var yb=xb.subscribe('resize',function(){var ac=this.scrollableArea.isScrolledToBottom();this.adjustScroller();ac&&this.scrollableArea.scrollToBottom();}.bind(this)),zb=o.listen(wb,'blur',function(){xb.unsubscribe(yb);zb.remove();});}}}.bind(this);g.subscribe('ufi/changed',function(wb,xb){if(this.ufiForm===xb.form)this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('ufi/comment',function(wb,xb){if(this.ufiForm===xb.form){this.adjustScrollerIfNecessary();if(xb.isranked){this.scrollableArea.scrollToTop();}else this.scrollableArea.scrollToBottom();}}.bind(this));o.listen(this.rhc,'click',function(event){var wb=event.getTarget();if(aa.byTag(wb,'a')||aa.byTag(wb,'button')||m.isNodeOfType(wb,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScrollerIfNecessary();}.bind(this));o.listen(this.ufiForm,'focusin',vb);};ub.prototype.openHandler=function(vb){"use strict";if(this.isOpen||!ca.isValid(vb)||this.returningToStart||vb.getQueryData().closeTheater||vb.getQueryData().permPage||vb.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(vb);this._uriStack.push(ua(vb).getQualifiedURI().toString());z.transitionComplete(true);return true;};ub.prototype.getImageSrc=function(vb){"use strict";if(vb.smallsrc){if(!vb.size)return vb.smallsrc;var wb=wa.deserialize(vb.size),xb=this.getStageSize(wb);xb=this._adjustStageSizeForPixelRatio(xb);if(xb.x<=ub.STAGE_NORMAL_MAX.x&&xb.y<=ub.STAGE_NORMAL_MAX.y)return vb.smallsrc;}return vb.src;};ub.prototype.open=function(vb){"use strict";var wb=ua(vb),xb=wb.getQueryData(),yb=ca.parse(wb);if(yb!==null){xb.fbid=yb.photo_id;xb.set=yb.set_token;}var zb=this.getImageSrc(xb);if(zb){delete xb.src;delete xb.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){xb.firstLoad=true;this.initialLoad=true;x.registerBlocker(function(){return this.isOpen;}.bind(this));}this.sessionID=Date.now();this.loadQuery=db(xb,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.source=null;this.saveTagSubscription=g.subscribe('PhotoTagger.SAVE_TAG',this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new ga();this.stream.init(da.VIEWER_SNOWLIFT,'PhotoViewerPagelet','pagelet_photo_viewer',this._shouldLog?this._logger:null,xb.tagSuggestionMode||'everyone');if(!!ua.getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(ua.getMostRecentURI().getQueryData().viewas+'');this.fetchInitialData();this.setLoadingState(ub.STATE_HTML,true);this.rhcCollapsed=false;this._open(vb,zb);j.loadModules(["SnowliftPicCropper"],function(ac){this.cropper=ac.getInstance(this);this.cropper.init();if(this.enableCropperOnInit){var bc=g.subscribe('PhotoSnowlift.SWITCH_IMAGE',function(){this.cropper.enableCropping();g.unsubscribe(bc);}.bind(this));this.enableCropperOnInit=false;}}.bind(this));j.loadModules(["PhotosButtonTooltips"],function(ac){ac.init();});};ub.prototype._open=function(vb,wb){"use strict";this.createLoader(wb);this.spotlight.show();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[o.listen(window,'resize',this.adjustForResize.bind(this)),o.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),o.listen(this.stageWrapper,'mouseleave',function(event){var zb=event.getTarget();if(!(aa.byClass(zb,'snowliftOverlay')||aa.byClass(zb,'fbPhotoSnowliftTagApproval')||aa.byClass(zb,'tagPointer')||aa.byClass(zb,'arrow')||aa.byClass(zb,'faceboxSuggestion')||aa.byClass(zb,'typeaheadWrapper')||aa.byClass(zb,'photoTagTypeahead')||aa.byClass(zb,'fbPhotoTagger')))this.unhiliteAllTags();this.hidePagers();}.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hilitePager.bind(this)),o.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this)),o.listen(this.overlay,'mouseenter',this.unhiliteAllTags.bind(this)),o.listen(this.container,'mousemove',this._enableMouseOver.bind(this)),o.listen(this.container,'mouseover',this._interceptMouseOver.bind(this)),o.listen(this.stageWrapper,'focusin',this.hilitePager.bind(this)),o.listen(this.rhc,'focusin',this.hidePagers.bind(this))];if(this._hasZoomCapability){this.stageHandlers.push(o.listen(this.stage,'mousedown',this._zoomedImageMouseDown.bind(this)));this.stageHandlers.push(o.listen(this.root,'mouseup',this._zoomedImageMouseUp.bind(this)));}this.stageHandlers.push(o.listen(this.container,'click',function(event){var zb=event.getTarget();if(aa.byClass(zb,'rotateRight')){this.rotate('right');}else if(aa.byClass(zb,'rotateLeft')){this.rotate('left');}else if(aa.byClass(zb,'closeTheater')){if(q.isFullScreen()){q.toggleFullScreen();return;}this.closingAction=ea.X;this.spotlight.hide();return false;}else if(this.fullscreen)if(aa.byClass(zb,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(aa.byClass(zb,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}.bind(this)));var xb=ib('fbPhotoSnowliftFeedback');if(xb)this.stageHandlers.push(o.listen(xb,'click',function(event){var zb=event.getTarget();if(aa.byClass(zb,'like_link')||(aa.byClass(zb,'UFILikeLink')&&aa.byClass(zb,'UIActionLinks')))this.toggleLikeButton();var ac=aa.byClass(event.getTarget(),'uiUfiCollapsedComment');if(ac)k.addClass(ac,'uiUfiCollapsedCommentToggle');}.bind(this)));var yb=ib('fbPhotoSnowliftOnProfile');if(yb)this.stageHandlers.push(o.listen(yb,'click',function(event){if(aa.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=ua.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!wb)this.setLoadingState(ub.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){z.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}ea.initLogging(ea.SNOWLIFT);if(this.pivots)ea.setRelevantCount(this.pivots.relevantCount);};ub.prototype.toggleFullScreen=function(){"use strict";var vb=q.toggleFullScreen(document.documentElement);if(vb){var wb=this.stream.getCurrentImageData();if(wb&&wb.url&&this.image.src!==wb.url&&this.shouldShowHiRes(wb))if(!this._log(wb.url))(new Image()).src=wb.url;if(this._isZoomOn){this._setZoomOut();k.show(this.image);}ea.logEnterFullScreen(this.stream.getCursor());}};ub.prototype.getStream=function(){"use strict";return this.stream;};ub.prototype.fetchInitialData=function(){"use strict";this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();ta.loadFromEndpoint('PhotoViewerInitPagelet',ib('pagelet_photo_viewer_init',this.root),this.loadQuery,{actorID:sa.getActorIDForFeedbackTargetIfExists(this.loadQuery.fbid),usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});};ub.prototype.toggleCollapse=function(){"use strict";if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();};ub.prototype.collapseRHC=function(){"use strict";this.rhcCollapsed=true;k.addClass(this.root,'collapseRHC');this.adjustForResize();};ub.prototype.uncollapseRHC=function(){"use strict";this.rhcCollapsed=false;k.removeClass(this.root,'collapseRHC');this.adjustForResize();};ub.prototype.beforeCloseHandler=function(){"use strict";if(this.isOpen&&this.cropper&&this.cropper.croppingMode){this.warnLeavePage(this.closeHandler.bind(this));return false;}};ub.prototype.closeHandler=function(){"use strict";if(!this.isOpen)return;this.closingAction=this.closingAction||ea.ESC;if(ua.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.returnToStartingURI(this.refreshOnClose);this.close();};ub.prototype.returnToStartingURI=function(vb,wb){"use strict";if(!vb)if(wb){this.squashNextTransition(kb.bind(null,wb));}else this.squashNextTransition();this.returningToStart=true;var xb=g.subscribe('page_transition',(function(){this.returningToStart=false;xb.unsubscribe();}).bind(this)),yb=vb||isNaN(va.opera()),zb=this._uriStack.length;if(yb&&zb<window.history.length){window.history.go(-zb);}else{var ac=this.startingURI,bc=new ua(ac).removeQueryData('closeTheater');if(ac.getQueryData().sk=='approve'&&ac.getPath()=='/profile.php'){bc.removeQueryData('highlight');bc.removeQueryData('notif_t');}kb(bc);}};ub.prototype.squashNextTransition=function(vb){"use strict";this.squashNext=true;z.registerHandler(function wb(){if(this.squashNext){this.squashNext=false;if(vb)setTimeout(vb,0);z.transitionComplete(true);return true;}return false;}.bind(this),7);};ub.prototype.handleNavigateAway=function(vb){"use strict";var wb=cb(z._most_recent_uri.getQualifiedURI(),vb.getAttribute('href'));if(this.isOpen&&(wb instanceof ua)&&wb.getUnqualifiedURI().toString()!=this.startingURI.toString()&&wb.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=ea.NAVIGATE;this.returnToStartingURI(false,wb);this.close();return false;}return true;};ub.prototype.postProcessTaggedPhotos=function(){"use strict";if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var vb=null;if(this.source===ub.COLLECTIONS_UNTAGGED_PHOTOS){vb='/ajax/photos/photo/edit/skiptag/';}else if(this.source===ub.PHOTOS_OF_YOU_SUGGESTIONS||this.source===ub.FRIENDS_IN_PHOTOS_SUGGESTIONS)vb='/ajax/photos/photo/add_to_star_grid/';if(vb)new i().setURI(vb).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send();}};ub.prototype.onTagSaved=function(vb,wb){"use strict";if(this.taggedPhotoIds){if(this.source===ub.PHOTOS_OF_YOU_SUGGESTIONS&&!wb.self_tag)return;this.taggedPhotoIds.push(wb.photo_fbid);}};ub.prototype.close=function(){"use strict";if(!this.isOpen)return;this.hideMorePhotos();this._pauseVideoIfNeeded();this.isOpen=false;this._navCount=0;if(this.fullscreen)q.disableFullScreen();mb('snowlift').uai('close');na.closeOverlayView('snowlift');this.cropper&&this.cropper.disableCropping();this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();g.unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;setTimeout(this.closeCleanup.bind(this),0);if(this.snowflake){k.removeClass(this.root,"snowflake");this.extraClasses.forEach(function(vb){k.removeClass(this.root,vb);},this);}this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0;};ub.prototype.closeCleanup=function(){"use strict";this.closeDirty=false;k.removeClass(this.root,'dataLoading');ea.logPhotoViews(this.closingAction);this.destroy();k.hide(this.errorBox);k.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var vb=this.stream.getCursor();k.removeClass(this.stageWrapper,'showVideo');m.empty(this.videoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();m.empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute('aria-busy','true');var wb=this.closingAction===ea.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){z.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',{is_navigating:wb,fbid:vb});this._setZoomOut();};ub.prototype.createLoader=function(vb){"use strict";if(this.currentImageSize===null){this.adjustStageSize(ub.STAGE_MIN);}else{var wb=this.getStageSize(this.currentImageSize);wb=new wa(Math.max(wb.x,ub.STAGE_MIN.x),Math.max(wb.y,ub.STAGE_MIN.y));var xb=this.getImageSizeInStage(this.currentImageSize,wb);if(this.thumbSrc===null){this.adjustStageSize(xb);}else this.useImage(m.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:xb.x+'px',height:xb.y+'px'}}),xb,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(vb)setTimeout((function(){var yb=new Image(),zb=o.listen(yb,'load',bb(function(){if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(vb,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(ub.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater')),ac=function(){if(zb){zb.remove();zb=null;}};g.subscribeOnce('PhotoSnowlift.SWITCH_IMAGE',ac);g.subscribeOnce('PhotoSnowlift.CLOSE',ac);this._log(vb);yb.src=vb;}).bind(this),0);k.hide(this.stageActions);this.setStagePagersState('disabled');};ub.prototype.initDataFetched=function(vb){"use strict";ea.setPhotoSet(this.stream.getPhotoSet());ea.setLogFbids(vb.logids);var wb=this.stream.getCurrentImageData();ea.addPhotoView(wb.info,this.shouldShowHiRes(wb),this.fullscreen&&q.isFullScreen());var xb=this.stream.getCurrentExtraData();if(this._showHover&&xb)ha.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(xb.tagRects));if(xb&&xb.source!==undefined){this.source=parseInt(xb.source,10);ea.setSource(this.source);}if(!this.pageHandlers)this.pageHandlers=[o.listen(this.root,'click',this.pageListener.bind(this)),o.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];k.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=vb.loggedin;this.disableAds=!this.isLoggedInViewer||vb.fromad||this.stream.isInViewAsMode();this.loadAds();var yb=new wa(this.stage.clientWidth,this.stage.clientHeight);if(wb&&this._shouldShowZoomButton(yb,wb.originalDimensions)){ea.addPanoramaImpression();this._displayZoomButton(yb);}else if(this._hasZoomCapability)k.hide(this.showZoomButton);};ub.prototype.adjustScrollerIfNecessary=function(){"use strict";clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0);};ub.prototype.adjustScroller=function(vb){"use strict";clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var wb=wa.getElementDimensions(this.rhc),xb=wb.y;xb-=wa.getElementDimensions(this.rhcHeader).y;xb-=wa.getElementDimensions(this.ufiInputContainer).y;if(this.placeInfo){var yb=wa.getElementDimensions(this.placeInfo);xb-=yb.y;pa.set(this.sideAdUnit,'bottom',yb.y+'px');}if(vb==null)vb=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=vb;xb=Math.max(0,xb);var zb=wa.getElementDimensions(this.scrollerBody).y,ac=Math.max(ub.MIN_UFI_HEIGHT,xb-vb);if(zb>=ac){if(xb>ac){k.removeClass(this.rhc,'pinnedUfi');xb-=ac;}else{k.addClass(this.rhc,'pinnedUfi');xb=0;}pa.set(this.scroller,'height',ac+'px');}else{pa.set(this.scroller,'height','auto');k.removeClass(this.rhc,'pinnedUfi');xb-=zb;}var bc=wa.getElementDimensions(this.ufiInputContainer).y;pa.set(this.ufiForm,'padding-bottom',bc+'px');fa.resize(new wa(wb.x,xb));this.scrollableArea.adjustGripper();};ub.prototype.adjustForResize=function(){"use strict";this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();if(this._hasZoomCapability){if(!this._isZoomOn)this._conditionDisplayZoomButton();this._repositionZoomedImageOnResize();}};ub.prototype.shouldShowHiRes=function(vb){"use strict";if(!vb||!vb.smallurl)return false;var wb=this.getStageSize(vb.dimensions);wb=this._adjustStageSizeForPixelRatio(wb);var xb=this.getImageSizeInStage(vb.dimensions,wb);return (xb.x>ub.STAGE_NORMAL_MAX.x||xb.y>ub.STAGE_NORMAL_MAX.y);};ub.prototype._adjustStageSizeForPixelRatio=function(vb){"use strict";if(window.devicePixelRatio&&window.devicePixelRatio>1)vb=new wa(vb.x*window.devicePixelRatio,vb.y*window.devicePixelRatio);return vb;};ub.prototype.getImageURL=function(vb){"use strict";if(vb.video){return null;}else if(vb.smallurl&&!this.shouldShowHiRes(vb))return vb.smallurl;return vb.url;};ub.prototype.getImageDimensions=function(vb){"use strict";if(this._isZoomOn)return vb.originalDimensions;if(vb.smalldims&&(!this.shouldShowHiRes(vb)||this.image.src===vb.smallurl))return vb.smalldims;return vb.dimensions;};ub.prototype.getStageSize=function(vb,wb){"use strict";var xb=wa.getViewportDimensions(),yb=new wa(vb.x,vb.y);if(wb)yb=new wa(Math.max(vb.x,wb.x),Math.max(vb.y,wb.y));var zb,ac;if(this.fullscreen&&q.isFullScreen()){return new wa((this.rhcCollapsed?screen.width:screen.width-ub.SIDEBAR_SIZE_MAX),screen.height-ub.FULL_SCREEN_PADDING*2);}else{zb=Math.min(yb.x,(xb.x-ub.SIDEBAR_SIZE_MAX-ub.STAGE_CHROME.x));ac=Math.min(yb.y,xb.y-ub.STAGE_CHROME.y);}if(zb===0&&ac===0)return new wa(0,0);var bc=zb/ac,cc=yb.x/yb.y;if(bc<cc)return new wa(zb,Math.round(zb/cc));return new wa(Math.round(ac*cc),ac);};ub.prototype.getImageSizeInStage=function(vb,wb){"use strict";var xb=vb.x,yb=vb.y;if(xb>=wb.x||yb>=wb.y){var zb=wb.x/wb.y,ac=xb/yb;if(zb<ac){xb=wb.x;yb=Math.round(xb/ac);}else if(zb>ac){yb=wb.y;xb=Math.round(yb*ac);}else{xb=wb.x;yb=wb.y;}}return new wa(xb,yb);};ub.prototype.getStageSizeForZoomedImage=function(vb,wb){"use strict";if(this.fullscreen&&q.isFullScreen()){var xb=this.rhcCollapsed?screen.width:screen.width-ub.SIDEBAR_SIZE_MAX,yb=screen.height-ub.FULL_SCREEN_PADDING*2;return new wa(xb,yb);}var zb=wa.getViewportDimensions();if(wb===null)wb=new wa(0,0);var ac=new wa(Math.max(vb.x,ub.STAGE_MIN.x,wb.x),Math.max(vb.y,ub.STAGE_MIN.y,wb.y));xb=Math.min(ac.x,(zb.x-ub.SIDEBAR_SIZE_MAX-ub.STAGE_CHROME.x));yb=Math.min(ac.y,zb.y-ub.STAGE_CHROME.y);return new wa(xb,yb);};ub.prototype.adjustStageSize=function(vb){"use strict";var wb=this.currentImageSize;if(vb){wb=vb;}else{var xb=this.stream&&this.stream.getCurrentImageData();if(xb)wb=this.getImageDimensions(xb);}if(!wb)return;this.currentImageSize=wb;var yb=0;if(this.shouldStretch&&!this.getVideoOnStage()&&wb.x>wb.y&&wb.x<=ub.TIMELINE_STRETCH_WIDTH&&wb.x>=ub.TIMELINE_STRETCH_MIN){wb.y=Math.round(wb.y*ub.TIMELINE_STRETCH_WIDTH/wb.x);wb.x=ub.TIMELINE_STRETCH_WIDTH;}else if(this.getVideoOnStage())yb=ub.VIDEO_BOTTOM_BAR_SPACE*2;var zb;if(this._isZoomOn){zb=this.getStageSizeForZoomedImage(wb,this.currentMinSize);}else zb=this.getStageSize(wb,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new wa(0,0);this.currentMinSize=new wa(Math.max(zb.x,ub.STAGE_MIN.x,this.currentMinSize.x),Math.max(zb.y,ub.STAGE_MIN.y,this.currentMinSize.y));var ac=this.getImageSizeInStage(wb,this.currentMinSize),bc=this.currentMinSize.x-ac.x,cc=this.currentMinSize.y-ac.y;if(bc>0&&bc<ub.PADDING_MIN){this.currentMinSize.x-=bc;}else if(cc>0&&cc<ub.PADDING_MIN)this.currentMinSize.y-=cc;var dc=this.currentMinSize.x+ub.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)dc=this.currentMinSize.x;this.snowliftPopup.style.cssText='width:'+dc+'px;'+'height:'+this.currentMinSize.y+'px;';var ec=this.currentMinSize.y-yb+'px';if(va.firefox()){var fc=pa.get(this.stageWrapper,'font-size');ec=((this.currentMinSize.y-yb)/parseFloat(fc))+'em';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+ec+';';if(this._isZoomOn){var gc=this.currentMinSize.y-yb;if(wb.y>gc){var hc=(wb.x/wb.y)*gc;pa.apply(this.zoomedImage,{width:hc+"px",height:gc+"px"});}else pa.apply(this.zoomedImage,{width:wb.x+"px",height:wb.y+"px"});}else this.image.style.cssText='width:'+ac.x+'px;'+'height:'+ac.y+'px;';var ic=this.getTagger();if(ic)ic.repositionTagger();this.adjustScrollerIfNecessary();};ub.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var vb=m.scry(this.stage,'div.tagsWrapper')[0],wb=wa.getElementDimensions(this.image);if(vb){pa.set(vb,'width',wb.x+'px');pa.set(vb,'height',wb.y+'px');}};ub.prototype.adsDisplayedCallback=function(vb,wb){"use strict";var xb=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&vb<ub.MIN_ADS_VISIBLE&&wb.length>=ub.MIN_ADS_VISIBLE;if(xb){this.inAdsDisplayedCallback=true;var yb=wb[ub.MIN_ADS_VISIBLE-1];this.adjustScroller(yb);this.inAdsDisplayedCallback=false;}};ub.prototype.setLoadingState=function(vb,wb){"use strict";switch(vb){case ub.STATE_IMAGE_PIXELS:k.conditionClass(this.root,'imagePixelsLoading',wb);break;case ub.STATE_IMAGE_DATA:this.loadingStates[vb]=wb;k.conditionClass(this.root,'imageLoading',wb);break;case ub.STATE_HTML:this.loadingStates[vb]=wb;k.conditionClass(this.root,'dataLoading',wb);this.rhc.setAttribute('aria-busy',wb?'true':'false');break;}};ub.prototype.destroy=function(){"use strict";this.stageHandlers.forEach(function(vb){vb.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(vb){vb.remove();});this.pageHandlers=null;}this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;this._videoPlayerStateManager=null;};ub.prototype.checkState=function(vb){"use strict";if(vb!=ub.STATE_ERROR&&!this.loadingStates[vb])return;switch(vb){case ub.STATE_IMAGE_DATA:var wb=this.stream.getCurrentImageData();if(wb){var xb=this.getImageURL(wb);if(xb){this.switchImage(xb,null,true);}else if(wb.video)this.switchVideo(wb.video,wb.info,true);this.setLoadingState(vb,false);}break;case ub.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(vb,false);}break;default:if(this.stream.errorInCurrent()){k.hide(this.image);k.show(this.errorBox);}break;}};ub.prototype.buttonListener=function(event){"use strict";var vb=event.getTarget(),wb=Date.now();if(aa.byClass(vb,"_10zt")){ea.addPanoramaClick();this.switchIntoZoomedImage();return;}if(aa.byClass(vb,"_10zu")){this._setZoomOut();this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));return;}if(aa.byClass(vb,'fbPhotoTagApprovalBox'))return;if(wb-this.lastPage<350)return;if(aa.byClass(vb,'fbPhotosPhotoLike')){this.likePhoto();}else if(aa.byClass(vb,'tagApproveIgnore')){this.updateTagBox(event,vb);}else if(aa.byClass(vb,"_5ge9")){this.hideMorePhotos();this.toggleSlideshow();return false;}else if(aa.byClass(vb,"_5ymu")){if(!this._showingMorePhotos){ha.logShowMorePhotos();var xb=this.stream.getCursor();if(xb)this.showMorePhotos(String(xb));if(this._hasZoomCapability)k.hide(this.showZoomButton);}else{ha.logHideMorePhotos();this._conditionDisplayZoomButton();this.hideMorePhotos();}return;}else if(aa.byClass(vb,"_27n"))this._conditionDisplayZoomButton();this.hideMorePhotos();};ub.prototype.toggleSlideshow=function(){"use strict";if(!this.slideshowGk)return;if(this._slideshowToken){this.stopSlideshow();}else this.startSlideshow();};ub.prototype.startSlideshow=function(){"use strict";this._slideshowToken=window.setInterval(this.page.bind(this,1,va.chrome()&&q.isFullScreen()),ub.SLIDESHOW_TIME);k.addClass(this.root,'slideshowStarted');k.removeClass(this.root,'slideshowAvailable');};ub.prototype.stopSlideshow=function(){"use strict";this._slideshowToken&&clearInterval(this._slideshowToken);this._slideshowToken=null;k.addClass(this.root,'slideshowAvailable');k.removeClass(this.root,'slideshowStarted');};ub.prototype.likePhoto=function(){"use strict";ea.addButtonLike();var vb=ab('fbPhotoSnowliftFeedback'),wb=m.scry(vb,'button.like_link')[0];if(!wb)wb=m.scry(vb,'a.UFILikeLink')[0];var xb=wb.getAttribute('href');if(q.isFullScreen())if(va.chrome())wb.setAttribute('href','javascript:;');wb.click();wb.setAttribute('href',xb);};ub.prototype.toggleLikeButton=function(){"use strict";var vb=m.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(vb){var wb=m.find(this.root,'.likeCount'),xb=m.find(wb,'.likeCountNum');if(wb)if(k.hasClass(vb,'viewerLikesThis')){m.setContent(xb,parseInt(xb.textContent,10)-1);}else m.setContent(xb,parseInt(xb.textContent,10)+1);k.toggleClass(vb,'viewerLikesThis');k.removeClass(vb,'viewerAlreadyLikedThis');}};ub.prototype.likePhotoWithKey=function(){"use strict";return v.like(this.likePhoto.bind(this),jb());};ub.prototype.updateTagBox=function(vb,wb){"use strict";this.unhiliteAllTags();var xb=ib(vb);if(!xb)return;k.addClass(xb,'tagBox');k.addClass(xb,'tagBoxPendingResponse');k.removeClass(xb,'tagBoxPending');k.hide(m.find(xb,'span.tagForm'));if(wb){k.show(m.find(xb,'span.tagApproved'));}else k.show(m.find(xb,'span.tagIgnored'));};ub.prototype.rotate=function(vb){"use strict";var wb=this.stream.getCursor();if(this.getVideoOnStage()){var xb=(vb=='left')?270:90;h.isTruthy(this.videoRotateURI,"Video rotate URI not set.");j.loadModules(["VideoRotate"],function(zb){new zb(wb,this.videoRotateURI).motionRotate(xb);}.bind(this));return;}var yb=db({fbid:wb,opaquecursor:this.stream.getOpaqueCursor(wb),cs_ver:da.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());yb[vb]=1;this.setLoadingState(ub.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(yb).setErrorHandler(this.rotationError.bind(this,wb)).setFinallyHandler(this.rotationComplete.bind(this,wb)).setMethod('POST').setReadOnly(false).send();};ub.prototype.rotationComplete=function(vb,wb){"use strict";if(vb==this.stream.getCursor()){this.setLoadingState(ub.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}};ub.prototype.rotationError=function(vb,wb){"use strict";if(vb==this.stream.getCursor()){this.setLoadingState(ub.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));j.loadModules(["AsyncResponse"],function(xb){xb.defaultErrorHandler(wb);});}};ub.prototype.saveTagsFromPayload=function(vb){"use strict";this.storeFromData(vb);if('data' in vb&&this.stream.getCursor() in vb.data)this.swapData();};ub.prototype.saveEdit=function(){"use strict";if(!k.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;j.loadModules(["PhotoInlineEditor","Form"],function(vb,wb){var xb=vb.getInstance(this.getViewerConst());xb&&wb.bootstrap(xb.getForm().controller);}.bind(this));};ub.prototype.mouseLeaveListener=function(event){"use strict";this.unhiliteAllTags();this.reHilitePendingTag();};ub.prototype.hilitePager=function(event){"use strict";var vb=wa.getEventPosition(event),wb=wa.getElementPosition(this.stage);if(y.isRTL()){var xb=wa.getElementDimensions(this.stage);this.stagePagerPrev=xb.x-(vb.x-wb.x)<ub.GOPREV_AREA;}else this.stagePagerPrev=vb.x-wb.x<ub.GOPREV_AREA;k.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);k.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var yb,zb=event.getTarget();if(!aa.byClass(zb,'snowliftOverlay')&&!aa.byClass(zb,'bottomBarActions')&&!aa.byClass(zb,'snowliftPager'))yb=ub.PAGER_FADE;this.showPagers(yb);};ub.prototype.showPagers=function(vb){"use strict";clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof vb!=='undefined')this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),vb);};ub.prototype.hidePagers=function(){"use strict";var vb=m.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(vb)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');};ub.prototype.getTagger=function(){"use strict";return (this.PhotoTagger&&this.PhotoTagger.getInstance(da.VIEWER_SNOWLIFT));};ub.prototype.unhiliteAllTags=function(){"use strict";clearTimeout(this.unhiliteTimer);m.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(wb){k.removeClass(wb,'hover');});m.scry(this.stage,'div.tagsWrapper div.otherActive').forEach(function(wb){k.removeClass(wb,'otherActive');});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!k.hasClass(this.root,'taggingMode')){var vb=this.getTagger();if(vb){vb.hideTagger();vb.setCurrentFacebox(null);}}};ub.prototype.switchHilitedTags=function(vb,wb){"use strict";if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();this.hiliteAllBoxes();var xb=ib(vb);if(xb){this.hilitedTag=vb;if(!k.hasClass(this.root,'taggingMode')&&ja.isFacebox(this.hilitedTag)){var yb=this.getTagger();if(yb){k.addClass(xb,'hover');var zb=yb.getFacebox(vb);yb.setCurrentFacebox(zb);if(zb)yb.addTagFromFacebox(zb);}}else k.addClass(xb,'hover');if(k.hasClass(xb,'tagBoxPending')&&!k.hasClass(xb,'showPendingTagName')&&wb===true){m.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(ac){k.removeClass(ac,'showPendingTagName');});k.addClass(xb,'showPendingTagName');}}};ub.prototype.reHilitePendingTag=function(){"use strict";var vb=ib(this.hilitedTag);if(vb&&k.hasClass(vb,'showPendingTagName'))return;var wb=m.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(wb)this.switchHilitedTags(wb.id);};ub.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var vb=event.getTarget();if(aa.byClass(vb,'snowliftOverlay')||aa.byClass(vb,'fbPhotoSnowliftTagApproval')||aa.byClass(vb,'tagPointer')||aa.byClass(vb,'arrow')||aa.byClass(vb,'faceboxSuggestion')||aa.byClass(vb,'typeaheadWrapper')||aa.byClass(vb,'photoTagTypeahead'))return;var wb=aa.byClass(vb,'tagBoxPending'),xb=false;if(this.hilitedTag){var yb=ib(this.hilitedTag);xb=yb&&k.hasClass(yb,'tagBoxPending');}var zb=((!this.hilitedTag&&wb)||(!xb&&wb));if(zb){this.switchHilitedTags(wb.id);return;}if(wb&&(wb.id==this.hilitedTag))return;var ac=250,bc=15,cc=wa.getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=cc;var dc=ja.absoluteToNormalizedPosition(this.image,cc);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(cc)<bc){return;}else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(dc))return;var ec=ja.getNearestBox(this.stream.getCurrentExtraData().tagRects,dc);if(!ec){if(!xb){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var fc=null;if(xb){var gc={};gc[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];fc=ja.getNearestBox(gc,dc);}if(fc!==null&&xb)return;if(this.hilitedTag!=ec)if(xb){this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,ec),ac);}else{if(this._showHover&&!this._seenTags[ec]){this._seenTags[ec]=true;ha.logPivotImpression('snowlift',ec);}this.switchHilitedTags(ec);}};ub.prototype.currentTagHasPrecedence=function(vb){"use strict";if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false;}var wb=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],xb=new ma(wb.t+(wb.h()/2),wb.r,wb.b+(ja.isFacebox(this.hilitedTag)?10:0),wb.l,wb.domain);return xb.contains(vb);};ub.prototype.getVideoOnStage=function(){"use strict";var vb=this.stream&&this.stream.getCurrentImageData();return vb&&vb.video;};ub.prototype.shouldPageOnAction=function(vb,wb){"use strict";if(!this.isOpen||v.isShowingConfirmation())return false;var xb=m.isNode(wb)&&(aa.byClass(wb,'snowliftPager')||aa.byClass(wb,'stagePagers')||aa.byClass(wb,'pivotPageColumn')),yb=m.isNode(wb)&&aa.byClass(wb,'stage'),zb=k.hasClass(wb,'faceBox'),ac=(!k.hasClass(this.root,'taggingMode')&&zb&&!xb);if(ac){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout((function(){m.find(this.getTagger().tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false;}var bc=((yb&&k.hasClass(this.root,'taggingMode'))||aa.byClass(wb,'tagBoxPending')||aa.byClass(wb,'tagBoxPendingResponse')||aa.byClass(wb,'fbPhotoTagApprovalBox')||aa.byClass(wb,'tag')||(this.cropper&&this.cropper.croppingMode));if(bc)return false;if(yb&&this._isZoomOn)return false;return vb==t.LEFT||vb==t.RIGHT||vb==nb||vb==ob||xb||ac||yb;};ub.prototype.keyHandler=function(vb,event){"use strict";if(event.getModifiers().any||u.getTopmostLayer()!==this.spotlight)return true;switch(o.getKeyCode(event)){case t.LEFT:case t.RIGHT:case nb:case ob:this.pageListener(event);return false;case pb:return this.toggleFullScreen();case qb:return this.likePhotoWithKey();case t.SPACE:this.toggleSlideshow();this.showPagers(ub.PAGER_FADE);return false;}};ub.prototype.shouldHandlePendingTag=function(event){"use strict";var vb=this.getTagger();if(!vb||!vb.tags.length)return false;var wb=ja.absoluteToNormalizedPosition(this.getImage(),wa.getEventPosition(event)),xb=vb.findNearestTag(wb);if(!xb||!k.hasClass(xb.node,'tagBoxPending'))return false;g.inform('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',{id:xb.id,version:this.getVersionConst()});return true;};ub.prototype.pageListener=function(event){"use strict";var vb=o.getKeyCode(event),wb=event.getTarget();if(this._slideshowToken){this.stopSlideshow();return;}if(!this.shouldPageOnAction(vb,wb))return;if(this.shouldHandlePendingTag(event))return;var xb=0;if(vb==t.RIGHT||vb==ob){xb=1;ea.setPagingAction('key_right');this._disableMouseOver=true;}else if(vb==t.LEFT||vb==nb){xb=-1;ea.setPagingAction('key_left');this._disableMouseOver=true;}else if(aa.byClass(wb,'next')){xb=1;ea.setPagingAction('click_next');}else if(aa.byClass(wb,'prev')){xb=-1;ea.setPagingAction('click_prev');}else if(!this.stagePagerPrev){xb=1;ea.setPagingAction('click_stage');}else{xb=-1;ea.setPagingAction('click_stage_back');}var yb=m.scry(this.ufiForm,'input.mentionsHidden'),zb=false;for(var ac=0;ac<yb.length;ac++)if(!s.isEmpty(yb[ac])){zb=true;break;}if(zb||k.hasClass(this.root,'fbPhotoSnowliftEditMode')||(this.cropper&&this.cropper.croppingMode)){this.warnLeavePage(this.page.bind(this,xb));}else{this.page(xb,va.chrome()&&q.isFullScreen());mb('snowlift',wb,event).uai(ea.pagingAction);}};ub.prototype.warnLeavePage=function(vb){"use strict";new l().setTitle("Are You Sure You Want To Leave This Page?").setBody("You have unsaved changes that will be lost if you leave the page.").setButtons([{name:'leave_page',label:"Leave This Page",handler:vb},{name:'continue_editing',label:"Stay on This Page",className:'inputaux'}]).setModal(true).show();};ub.prototype.getUsesOpaqueCursor=function(){"use strict";return this.stream.getUsesOpaqueCursor();};ub.prototype.getOpaqueCursor=function(vb){"use strict";return this.stream.getOpaqueCursor(vb);};ub.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};ub.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};ub.prototype.page=function(vb,wb){"use strict";if(!this.stream.isValidMovement(vb)||!this.stream.nonCircularPhotoSetCanPage(vb)){this.showPagers(ub.PAGER_FADE);return;}var xb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(vb));if(this.snowflake&&((this.stream.getCursor()==this.firstInSet&&vb<0)||(this.firstInSet==xb&&vb>0))){this.showPagers(ub.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};var yb=this.getVideoOnStage();if(yb)this.switchVideo(yb,null,false);if(this.pivots&&this.pivots.page(vb))return;g.inform('PhotoSnowlift.PAGE');qa.hide();this.recacheData();this.stream.moveCursor(vb);k.hide(this.image);if(vb!==0){this.storyID=null;this._updateContainerOwnerID();}if(this._isZoomOn)this._setZoomOut();if(this.stream.errorInCurrent()){this.setLoadingState(ub.STATE_HTML,true);k.show(this.errorBox);return;}this.movementDelta+=vb;var zb=this.stream.getCurrentImageData();if(zb){var ac=this.getImageURL(zb);if(ac){this.switchImage(ac,null,true);}else if(zb.video)this.switchVideo(zb.video,zb.info,true);if(!wb){this.replaceUrl=true;kb(zb.info.permalink);}this.setLoadingState(ub.STATE_IMAGE_DATA,false);}else{this.setLoadingState(ub.STATE_IMAGE_PIXELS,true);this.setLoadingState(ub.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(ub.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();if(this.cropper)this.cropper.resetPhoto();this.setLeftAndRightPagersState();if(this._slideshowToken){k.addClass(this.root,'slideshowStarted');}else if(this.slideshowAvailable)k.addClass(this.root,'slideshowAvailable');if(this._showMorePhotos&&this._albumFBID){this._navCount+=vb;var bc=Math.abs(this._navCount);if(this.stream.allLoaded&&bc===this.stream.getLength()-1)ia.fetch(this._albumFBID,this.stream);if(this.stream.allLoaded&&bc===this.stream.getLength()){ha.logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0;}else{this.hideMorePhotos();this.hidePagers();}}};ub.prototype.showMorePhotos=function(vb,wb){"use strict";if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement('div'));k.addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=la.renderComponent(la.createElement(xa,{fbid:vb,onclose:this.hideMorePhotos.bind(this),endofalbum:wb||false}),this.searchPivot);};ub.prototype.hideMorePhotos=function(){"use strict";if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;k.removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null});}};ub.prototype.logImpressionDetailsForPhoto=function(){"use strict";var vb=[].concat(m.scry(ab('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),m.scry(ab('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(vb.length===0)return;var wb={};for(var xb=0;xb<vb.length;xb++)wb[vb[xb].name]=vb[xb].value;if(this.getVideoOnStage()){wb.width=0;wb.height=0;}else{var yb=this.getImageDimensions(this.stream.getCurrentImageData());wb.width=yb.x;wb.height=yb.y;}ea.addDetailData(this.stream.getCursor(),wb);fa.setIsLogAdData(true);};ub.prototype.loadAds=function(){"use strict";if(this.disableAds)return;fa.loadAdsFromUserActivity();};ub.prototype.transitionHandler=function(vb){"use strict";if(vb.getQueryData().closeTheater||vb.getQueryData().permPage||vb.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(vb.getQualifiedURI().toString());z.transitionComplete(true);return true;}var wb=this._uriStack.length;if(wb>=2&&this._uriStack[wb-2]==vb.getQualifiedURI().toString())this._uriStack.pop();var xb=this.stream.getCursorForURI(vb.getUnqualifiedURI().toString());if(xb){var yb=this.stream.getRelativeMovement(xb);this.page(yb,true);z.transitionComplete(false);return true;}if(this.isOpen){z.transitionComplete(true);this.close();return true;}this.transitionHandlerRegistered=false;return false;};ub.prototype.recacheData=function(){"use strict";if(!this.loadingStates.html){var vb=this.stream.getCurrentHtml();for(var wb in vb){vb[wb]=eb(ab(wb).childNodes);m.empty(ab(wb));}}};ub.prototype.reloadIfTimeout=function(){"use strict";if(!r.hasLoaded(this.image)){var vb=this.makeNewImage(this.image.src,true);o.listen(vb,'load',this.useImage.bind(this,vb,null,true));this._log(vb.src);}};ub.prototype.useImage=function(vb,wb,xb){"use strict";if(xb&&r.hasLoaded(this.image))return;m.replace(this.image,vb);this.image=vb;this.adjustStageSize(wb);};ub.prototype.makeNewImage=function(vb,wb){"use strict";if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!wb)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),ub.LOADING_TIMEOUT);var xb=m.create('img',{className:'spotlight',alt:''});xb.setAttribute('aria-describedby','fbPhotosSnowliftCaption');xb.setAttribute('aria-busy','true');o.listen(xb,'load',bb(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout((function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this),0);}.bind(this),'photo_theater'));this._log(vb);xb.src=vb;return xb;};ub.prototype.switchImage=function(vb,wb,xb){"use strict";k.hide(this.image);k.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var yb=this.stream&&this.stream.getCurrentImageData();if(yb){ea.addPhotoView(yb.info,this.shouldShowHiRes(yb),this.fullscreen&&q.isFullScreen());if(this._showHover){var zb=this.stream.getCurrentExtraData();if(zb)ha.logImageImpression('snowlift',String(this.stream.getCursor()),Object.keys(zb.tagRects));}}this.useImage(this.makeNewImage(vb,false),wb,false);if(xb)this.stream.preloadImages(this.shouldShowHiRes.bind(this));if(this.cropper&&this.cropper.croppingMode)this.cropper.resetPhoto();var ac=new wa(this.stage.clientWidth,this.stage.clientHeight);if(yb&&this._shouldShowZoomButton(ac,yb.originalDimensions)){ea.addPanoramaImpression();this._displayZoomButton(ac);}else if(this._hasZoomCapability)k.hide(this.showZoomButton);g.inform('PhotoSnowlift.SWITCH_IMAGE');};ub.prototype._conditionDisplayZoomButton=function(){"use strict";if(!this._hasZoomCapability)return;var vb=this.stream&&this.stream.getCurrentImageData(),wb=vb&&vb.originalDimensions;if(!wb)return;var xb=new wa(this.stage.clientWidth,this.stage.clientHeight);if(this._shouldShowZoomButton(xb,wb)){this._displayZoomButton(xb);}else k.hide(this.showZoomButton);};ub.prototype._displayZoomButton=function(vb){"use strict";var wb=parseInt(this.image.style.height,10),xb=(vb.y-wb)/2;if(xb>=ub.ZOOM_BUTTON_TOP_PAD+ub.ZOOM_BUTTON_BOT_PAD+ub.ZOOM_BUTTON_HEIGHT){var yb=xb-ub.ZOOM_BUTTON_HEIGHT-ub.ZOOM_BUTTON_TOP_PAD;pa.set(this.showZoomButton,'bottom',yb+'px');}else pa.set(this.showZoomButton,'bottom','60px');k.show(this.showZoomButton);};ub.prototype._shouldShowZoomButton=function(vb,wb){"use strict";if(!this._hasZoomCapability||!wb)return false;var xb=wb.x/wb.y,yb=Math.min(vb.y*xb,wb.x);if(!isNaN(xb)&&xb>2&&wb.y>ub.MIN_PANORAMA_Y&&vb.x*ub.MIN_PANO_TO_STAGE_RATIO<yb){return true;}else return false;};ub.prototype._setZoomIn=function(){"use strict";this._isZoomOn=true;k.hide(this.showZoomButton);k.show(this.zoomOutSwitch);k.hide(this.stageActions);pa.set(this.stage,'overflow','hidden');};ub.prototype._setZoomOut=function(){"use strict";if(!this._hasZoomCapability)return;this._isZoomOn=false;pa.set(this.stage,'overflow','visible');k.hide(this.showZoomButton);k.hide(this.zoomedImage);k.hide(this.outerImageSlider);k.hide(this.zoomOutSwitch);k.show(this.stageActions);};ub.prototype.switchIntoZoomedImage=function(vb){"use strict";this._setZoomIn();k.hide(this.zoomedImage);k.hide(this.outerImageSlider);var wb=this.stream.getCurrentImageData(),xb=wb.originalDimensions;this.zoomedImage.src=wb.url;this.adjustStageSize(xb);this._initializeZoomedImagePositions(new wa(parseInt(pa.get(this.zoomedImage,'width'),10),parseInt(pa.get(this.zoomedImage,'height'),10)));k.hide(this.image);};ub.prototype._adjustInnerImageSlider=function(vb){"use strict";var wb=this.stage.clientWidth,xb=Math.min(100,(wb/vb.x)*100);pa.set(this.innerImageSlider,'width',xb+'%');return xb;};ub.prototype._getSliderSizeForZoomedImage=function(vb){"use strict";var wb=ub.MAX_SLIDER_HEIGHT*this.stage.clientHeight/vb.y,xb=ub.MAX_SLIDER_WIDTH*this.stage.clientWidth/vb.x,yb=Math.min(wb,xb);return new wa(100*vb.x*yb/this.stage.clientWidth,100*vb.y*yb/this.stage.clientHeight);};ub.prototype._initializeZoomedImagePositions=function(vb){"use strict";var wb=this.stage.clientWidth,xb=this._adjustInnerImageSlider(vb);pa.set(this.innerImageSlider,'marginLeft',(50-xb/2)+'%');pa.set(this.zoomedImage,'marginLeft',((wb-vb.x)/2)+'px');var yb=this._getSliderSizeForZoomedImage(vb);pa.set(this.outerImageSlider,'width',yb.x+'%');pa.set(this.outerImageSlider,'height',yb.y+'%');pa.set(this.outerImageSlider,'left',(50-yb.x/2)+'%');k.show(this.zoomedImage);k.show(this.outerImageSlider);};ub.prototype._zoomedImageMouseDown=function(event){"use strict";if(!this._isZoomOn)return;k.addClass(this.stage,'showSlider');if(this._zoomedImageMouseMoveHandle)this._zoomedImageMouseMoveHandle.remove();var vb=event.getTarget();if(aa.byClass(vb,"_10zv")){this.startSliderMargins=new wa(parseFloat(pa.get(this.innerImageSlider,'marginLeft')),parseFloat(pa.get(this.innerImageSlider,'marginTop')));this.startImageMargins=null;}else if(aa.byClass(vb,"_10zw")){this.startImageMargins=new wa(parseInt(pa.get(this.zoomedImage,'marginLeft'),10),parseInt(pa.get(this.zoomedImage,'marginTop'),10));this.startSliderMargins=null;}this.mouseDownStartPosition=new wa(event.clientX,event.clientY);this._zoomedImageMouseMoveHandle=o.listen(this.stage,'mousemove',this._zoomedImagePan.bind(this));event.kill();};ub.prototype._zoomedImageMouseUp=function(event){"use strict";if(this._zoomedImageMouseMoveHandle){k.removeClass(this.stage,'showSlider');this._zoomedImageMouseMoveHandle.remove();this._zoomedImageMouseMoveHandle=null;}};ub.prototype._zoomedImagePan=function(event){"use strict";var vb;if(this.startSliderMargins){vb=event.clientX-this.mouseDownStartPosition.x;var wb=parseFloat(pa.get(this.outerImageSlider,'width')),xb=parseFloat(pa.get(this.innerImageSlider,'width')),yb=Math.max(0,Math.min(wb-xb,this.startSliderMargins.x+vb))/wb;pa.set(this.innerImageSlider,'marginLeft',100*yb+"%");pa.set(this.zoomedImage,'marginLeft',-1*yb*this.zoomedImage.width+'px');event.kill();}else if(this.startImageMargins){vb=1.75*(this.mouseDownStartPosition.x-event.clientX);var zb=Math.min(0,Math.max(this.startImageMargins.x-vb,-this.zoomedImage.width+this.stage.clientWidth));pa.set(this.zoomedImage,'marginLeft',zb+'px');pa.set(this.innerImageSlider,'marginLeft',(-zb/this.zoomedImage.width*100)+"%");event.kill();}};ub.prototype._repositionZoomedImageOnResize=function(){"use strict";var vb=Math.min(0,Math.max(parseInt(pa.get(this.zoomedImage,'marginLeft'),10),-this.zoomedImage.width+this.stage.clientWidth));pa.set(this.zoomedImage,'marginLeft',vb+'px');pa.set(this.innerImageSlider,'marginLeft',(-vb/this.zoomedImage.width*100)+"%");this._adjustInnerImageSlider(new wa(this.zoomedImage.width,this.zoomedImage.height));};ub.prototype.switchVideo=function(vb,wb,xb){"use strict";this._pauseVideoIfNeeded();var yb='swf_'+vb;m.empty(this.videoStage);if(xb){k.addClass(this.stageWrapper,'showVideo');var zb=this.stream.getCurrentImageData(),ac=null;if(zb.video_element){ac=zb.video_element;ac.style.cssText='';ac.firstChild.style.cssText='';}else{ac=m.create('div');ac.setAttribute('data-flash',true);ac.id=vb;}k.addClass(ac,'videoStageContainer');m.appendContent(this.videoStage,ac);if(zb.ctaendscreen)m.appendContent(this.videoStage,zb.ctaendscreen);if(window[yb]&&!ib(yb))window[yb].write(vb);var bc='video_warning_'+vb,cc=ib(vb);if(!this.videoWarnings)this.videoWarnings=[];if(cc&&this.videoWarnings[bc])m.setContent(cc,this.videoWarnings[bc]);if(!zb.controller){var dc=wb?wb.fbid.toString():null,ec={root_element:cc?cc.parentNode:null,video_element:cc,cta_endscreen:zb.ctaendscreen};this._videoPlayerStateManager=new ya({player_version:wb?wb.playerversion:'casablanca',source:'snowlift',video_id:dc},ec);}else{this._videoPlayerStateManager=zb.controller;this._videoPlayerStateManager.reset();}if(this._autoplayVideos)this._videoPlayerStateManager.play(za.USER);setTimeout(this.adjustStageSizeForVideo.bind(this,yb),0);}else{window[yb]&&window[yb].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);k.removeClass(this.stageWrapper,'showVideo');}};ub.prototype.checkVideoStatus=function(vb){"use strict";if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var wb=this.getVideoOnStage();if(!wb){return;}else{var xb='swf_'+wb;if(vb!==xb)return;this.adjustStageSizeForVideo(vb);}};ub.prototype.adjustStageSizeForVideo=function(vb){"use strict";var wb=ib(vb);if(!wb){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,vb),200);}else this.adjustStageSize(new wa(wb.width,wb.height));};ub.prototype.handleServerError=function(vb,wb){"use strict";m.setContent(this.errorBox,vb);this.storeFromData(wb);};ub.prototype.fixButtonText=function(vb){"use strict";if(!this.buttonTruncateGk)return;var wb=m.scry(vb,".photosTruncatingUIButton"),xb=parseInt(pa.get(vb,'width'),10);if(xb>rb){var yb={tagPhoto:"Tag Photo",doneTagPhoto:"Done Tagging",addLocation:"Add Location",editPhoto:"Edit"};for(var zb=0;zb<wb.length;zb++){var ac=wb[zb];k.addClass(ac,"_2n0k");ra.set(ac,yb[ac.getAttribute('data-buttonname')],'below','center');}}};ub.prototype.swapData=function(){"use strict";var vb,wb=this.stream.getCurrentHtml();if(wb){this.setLoadingState(ub.STATE_HTML,false);for(var xb in wb){vb=ib(xb);vb&&m.setContent(vb,wb[xb]);}var yb=ib('photosTruncatingUIButtonGroup');yb&&this.fixButtonText(yb);g.inform('PhotoSnowlift.DATA_CHANGE',db(this.stream.getCurrentImageData().info,{movement:this.movementDelta}),g.BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();};ub.prototype.updateTotalCount=function(vb,wb,xb){"use strict";var yb=this.stream.getCurrentHtml();if(yb){var zb=ab('fbPhotoSnowliftPositionAndCount');m.replace(zb,xb);zb=xb;k.show(zb);var ac='fbPhotoSnowliftPositionAndCount';yb[ac]=eb(zb.childNodes);}this.stream.setTotalCount(vb);this.stream.setFirstCursorIndex(wb);};ub.prototype.addPhotoFbids=function(vb,wb,xb,yb){"use strict";if(yb&&this.sessionID&&yb!=this.sessionID)return;var zb=this.stream.getCursor()===null;this.stream.attachToFbidsList(vb,wb,xb);if(xb&&zb)this.page(0,true);if(this.pivots&&xb)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');if(!this.slideshowAvailable&&this.stream.canPage()){this.slideshowAvailable=true;k.addClass(this.root,'slideshowAvailable');}this.setLeftAndRightPagersState();};ub.prototype.attachTagger=function(vb){"use strict";m.appendContent(this.stageActions,vb);};ub.prototype.storeFromData=function(vb){"use strict";if(!this.isOpen)return;if(vb.ssid&&this.sessionID&&this.sessionID!=vb.ssid)return;var wb=this.stream.storeToCache(vb);if('error' in wb){this.checkState(ub.STATE_ERROR);return;}if('init' in vb){this._albumFBID=vb.init.album_fbid;this._autoplayVideos=vb.init.autoplay_videos;}if('init' in wb){this.initDataFetched(wb.init);if(this.openExplicitly){this.replaceUrl=true;kb(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.setLeftAndRightPagersState();this.ua&&this.ua.add_event('ufi');}if('image' in wb)this.checkState(ub.STATE_IMAGE_DATA);if('data' in wb)this.checkState(ub.STATE_HTML);};ub.prototype.setLeftAndRightPagersState=function(){"use strict";if(this.stream.isNonCircularPhotoSet()){k.conditionClass(this.root,'disableLeft',!this.stream.nonCircularPhotoSetCanPage(-1));k.conditionClass(this.root,'disableRight',!this.stream.nonCircularPhotoSetCanPage(1));}if(this.snowflake){k.conditionClass(this.root,'disableLeft',this.stream.getCursor()==this.firstInSet);var vb=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));k.conditionClass(this.root,'disableRight',vb==this.firstInSet);}};ub.prototype.setStagePagersState=function(vb){"use strict";switch(vb){case 'ready':k.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':k.addClass(this.root,'pagingActivated');return;case 'inactive':k.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':k.removeClass(this.root,'pagingReady');return;}};ub.prototype.deletePhoto=function(vb){"use strict";this.closeRefresh();};ub.prototype.closeRefresh=function(){"use strict";this.refreshOnClose=true;this.spotlight.hide();};ub.prototype.onHiliteTag=function(vb,wb){"use strict";if(wb.version!=da.VIEWER_SNOWLIFT)return;var xb=wb.tag;if(xb)this.switchHilitedTags(xb,true);};ub.prototype.onUpdateTagBox=function(vb,wb){"use strict";if(wb.version==da.VIEWER_SNOWLIFT)this.updateTagBox(wb.id,wb.approve);};ub.prototype._log=function(vb){"use strict";if(this._shouldLog){this._logger&&this._logger.log(vb);return true;}return false;};ub.prototype._enableMouseOver=function(){"use strict";this._disableMouseOver=false;};ub.prototype._interceptMouseOver=function(event){"use strict";if(this._disableMouseOver)event.kill();};ub.prototype.isReturningToStart=function(){"use strict";return !!this.returningToStart;};ub.prototype._pauseVideoIfNeeded=function(){"use strict";if(this._videoPlayerStateManager)this._videoPlayerStateManager.logStopForUnload();};ub.getInstance=function(){"use strict";if(!ub._instance)ub._instance=new ub();return ub._instance;};ub.initWithSpotlight=function(vb,wb){"use strict";ub.getInstance().init(vb,wb);};ub.addPhotoFbids=function(vb,wb,xb,yb){"use strict";ub.getInstance().addPhotoFbids(vb,wb,xb,yb);};ub.setReachedLeftEnd=function(){"use strict";ub.getInstance().setReachedLeftEnd();};ub.setReachedRightEnd=function(){"use strict";ub.getInstance().setReachedRightEnd();};ub.attachFollowFlyout=function(vb){"use strict";m.insertAfter(ab('fbPhotoSnowliftSubscribe'),vb);};ub.attachSubscribeFlyout=function(vb){"use strict";m.insertAfter(ab('fbPhotoSnowliftSubscribe'),vb);};ub.attachTagger=function(vb){"use strict";ub.getInstance().attachTagger(vb);};ub.preload=function(vb,wb){"use strict";ub.getInstance().preload(vb,wb);};ub.bootstrap=function(vb,wb){"use strict";var xb=vb&&ua(vb).getQueryData();if(xb&&xb.hasOwnProperty('share_id')){j.loadModules(["SpotlightShareViewer"],function(yb){yb.bootstrap(vb,wb);});return;}ub.getInstance().bootstrap(vb,wb);};ub.closeRefresh=function(){"use strict";ub.getInstance().closeRefresh();};ub.deletePhoto=function(vb){"use strict";ub.getInstance().deletePhoto(vb);};ub.getImage=function(){"use strict";return ub.getInstance().getImage();};ub.getImageId=function(){"use strict";return ub.getInstance().getImageId();};ub.getLoadQuery=function(){"use strict";return ub.getInstance().getLoadQuery();};ub.getRHCBody=function(){"use strict";return ub.getInstance().getRHCBody();};ub.getRHCFooter=function(){"use strict";return ub.getInstance().getRHCFooter();};ub.getRHCHeader=function(){"use strict";return ub.getInstance().getRHCHeader();};ub.getRoot=function(){"use strict";return ub.getInstance().getRoot();};ub.likePhotoSkipConfirmation=function(vb){"use strict";ub.getInstance().likePhotoSkipConfirmation(vb);};ub.saveTagsFromPayload=function(vb){"use strict";ub.getInstance().saveTagsFromPayload(vb);};ub.saveTagsFromPayloadDelayed=function(vb){"use strict";setTimeout(ub.saveTagsFromPayload.bind(null,vb),2000);};ub.handleServerError=function(vb,wb){"use strict";ub.getInstance().handleServerError(vb,wb);};ub.setVideoWarning=function(vb,wb){"use strict";var xb=ub.getInstance(),yb='video_warning_'+vb;if(!xb.videoWarnings)xb.videoWarnings=[];xb.videoWarnings[yb]=wb;};ub.storeFromData=function(vb){"use strict";ub.getInstance().storeFromData(vb);};ub.swapData=function(){"use strict";ub.getInstance().swapData();};ub.updateTotalCount=function(vb,wb,xb){"use strict";ub.getInstance().updateTotalCount(vb,wb,xb);};ub.setVideoRotateURI=function(vb){"use strict";ub.getInstance().videoRotateURI=vb;};db(ub,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:360,MIN_PANORAMA_Y:240,ZOOM_BUTTON_HEIGHT:52,ZOOM_BUTTON_BOT_PAD:60,ZOOM_BUTTON_TOP_PAD:16,MAX_SLIDER_HEIGHT:.075,MAX_SLIDER_WIDTH:.75,MIN_PANO_TO_STAGE_RATIO:1.2,STAGE_CHROME:{x:82,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,SLIDESHOW_TIME:3000,_instance:null,touch:hb,touchMarkup:hb});db(ub.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:ub.STAGE_NORMAL_MAX,stageChrome:ub.STAGE_CHROME,stagePagerPrev:null,ua:null,PhotoTagger:null});e.exports=ub;},null);
__d("Spotlight",["Arbiter","ArbiterMixin","DOM","JSXDOM","Layer","LayerAutoFocus","LayerTabIsolation","ModalLayer","Vector","classWithMixins","copyProperties","csx","cx","joinClasses","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=p(k,u(h));for(var w in v)if(v.hasOwnProperty(w))y[w]=v[w];var x=v===null?null:v.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=v;function y(aa,ba){"use strict";v.call(this,aa,ba);this.stageMinSize=new o(0,0);this.stagePadding=new o(0,0);}y.prototype._buildWrapper=function(aa,ba){"use strict";var ca=t("_n8 _3qx",aa.rootClassName);return (j.div({className:ca},j.div({className:"_n9"},ba)));};y.prototype._getDefaultBehaviors=function(){"use strict";return x._getDefaultBehaviors.call(this).concat([z,l,m,n]);};y.prototype.getContentRoot=function(){"use strict";if(!this._content)this._content=i.find(this.getRoot(),"div._n3");return this._content;};y.prototype.configure=function(aa){"use strict";if(aa.stageMinSize)this.stageMinSize=aa.stageMinSize;if(aa.stagePadding)this.stagePadding=aa.stagePadding;};y.prototype.onContentLoaded=function(){"use strict";this.inform('content-load');};y.prototype.updatePermalink=function(aa){"use strict";this.inform('permalinkchange',aa);};q(y.prototype,{stageMinSize:null,stagePadding:null});function z(aa){"use strict";this._layer=aa;}z.prototype.enable=function(){"use strict";this._subscription=this._layer.subscribe(['show','hide'],function(aa,ba){if(aa==='show'){g.inform('layer_shown',{type:'Spotlight'});}else g.inform('layer_hidden',{type:'Spotlight'});});};z.prototype.disable=function(){"use strict";this._subscription.unsubscribe();this._subscription=null;};q(z.prototype,{_subscription:null});e.exports=y;},null);
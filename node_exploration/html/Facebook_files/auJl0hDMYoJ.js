/*!CK:1624445913!*//*1410748654,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["TYUBn"]); }

__d("VideoEncodeCard.react",["FBAnimatedProgressBar.react","Animation","Arbiter","AsyncRequest","BanzaiLogger","ChannelConstants","DOM","Ease","React","Image.react","SubscriptionsHandler","XVideoHideEncodeCardControllerURIBuilder","XUICard.react","XUICloseButton.react","XUIText.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x=6000,y=250,z='video_encode',aa='video_thumbnail_generated',ba='VideoEncodeCardLoggerConfig',ca='hide',da='render',ea={done:"Your video is ready!",error:"We're sorry, but your video couldn't be processed.",processing:"Your video is being processed. When it's done, it'll be posted to Facebook.",retry:"Your video couldn't be processed, but we'll keep trying."},fa=o.createClass({displayName:'VideoEncodeCard',propTypes:{progressBarConfig:o.PropTypes.object.isRequired,videoID:o.PropTypes.string.isRequired},getInitialState:function(){return {duration:0,errorMessage:'',message:'processing',targetPercent:0,thumbnailLoaded:false,thumbnailSrc:null};},componentWillMount:function(){if(this.props.thumbUrl)this.setState({thumbnailSrc:this.props.thumbUrl});},componentDidMount:function(){this._subscriptionsHandler=new q();this._subscriptionsHandler.addSubscriptions(i.subscribe(this._getChannelType(z),this._handleChannelUpdates),i.subscribe(this._getChannelType(aa),this._updateThumbnail));k.log(ba,{event:da,video_id:this.props.videoID,origin:this.props.origin});},componentWillUnmount:function(){this._subscriptionsHandler.release();},_resetProgress:function(){this.setState({targetPercent:0,duration:0});},_getChannelType:function(ga){return l.getArbiterType(ga);},_updateThumbnail:function(event,ga){if(ga.obj.videoID==this.props.videoID)this.setState({thumbnailSrc:ga.obj.thumbUrl});},_handleChannelUpdates:function(event,ga){if(ga.obj.videoID!=this.props.videoID)return;var ha=ga.obj.error,ia=ga.obj.extra,ja=ga.obj.progress,ka=ga.obj.stage;if(ia.quality)ka+='_'+ia.quality;if(ha){this._onError(ha,ia.is_permanent_error);return;}else this.setState({errorMessage:'',message:'processing'});var la=this.props.progressBarConfig.stages[ka];if(!la)return;if(ia.hasOwnProperty('progress')){ja=Math.min(100,ja+(ia.progress*la.percent)/100);}else ja=Math.min(100,ja+la.percent);if(!la.hasOwnProperty('duration')){if(!ia.hasOwnProperty('time_left'))return;this.setState({targetPercent:ja,duration:ia.time_left});return;}this.setState({targetPercent:ja,duration:la.duration});if(ka=="finish"){this.setState({message:'done'});setTimeout(this._hideCard,x);}},_onError:function(ga,ha){if(!ha){this.setState({message:'retry'});this._resetProgress();}else{this.setState({errorMessage:ga.__html,message:'error'});this._resetProgress();}},_hideCard:function(){this._subscriptionsHandler.release();var ga=this.getDOMNode(),ha=n.makePowerIn(3);new h(ga).from('opacity',1).to('opacity',0).to('height','0%').to('margin-bottom',0).to('margin-top',0).to('padding-bottom',0).to('padding-top',0).duration(y).ease(ha).go().ondone(function(){m.remove(ga);});},_hideButtonClickHandler:function(){this._hideCard();this._addCardHideAssoc();k.log(ba,{event:ca,video_id:this.props.videoID,origin:this.props.origin});},_addCardHideAssoc:function(){var ga=new r().setString('video_id',this.props.videoID).getURI();new j(ga).send();},_onThumbnailLoad:function(){this.setState({thumbnailLoaded:true});},render:function(){var ga=null;if(this.state.thumbnailSrc){var ha=(("_52rg")+(this.state.thumbnailLoaded?' '+"_2ub3":''));ga=o.createElement(p,{className:ha,src:this.state.thumbnailSrc,onLoad:this._onThumbnailLoad});}var ia=this.state.message==='error'?o.createElement(u,{size:"medium",dangerouslySetInnerHTML:{__html:this.state.errorMessage}}):o.createElement(u,{size:"medium"},ea[this.state.message]);return (o.createElement(s,{className:"_4naz"},o.createElement(o.DOM.div,{className:"_10au"},ga,o.createElement(o.DOM.div,{className:(("_10av")+(this.state.message=='error'?' '+"_5q6t":''))},o.createElement(o.DOM.div,{className:"_2fs7"}))),o.createElement(o.DOM.div,{className:"_10aw"},ia),o.createElement(o.DOM.div,{className:"clearfix"}),o.createElement(g,{animate:this.state.message!='error'&&this.state.message!='retry',className:"_25c",duration:this.state.duration,percent:this.state.targetPercent}),o.createElement(t,{className:"_10ax",size:"medium",tooltip:"Hide",onClick:this._hideButtonClickHandler})));}});e.exports=fa;},null);
__d("VideoEncodeCardHandler",["Arbiter","CSS","DOM","React","VideoEncodeCard.react"],function(a,b,c,d,e,f,g,h,i,j,k){var l='server',m='client',n={_alreadySubscribed:false,_cardsContainer:null,_progressBarConfig:null,initHandler:function(o,p){this._cardsContainer=o;this._progressBarConfig=p;if(!this._alreadySubscribed){g.subscribe('videoUpload/complete',this.addVideoEncodeCardFromClient.bind(this));this._alreadySubscribed=true;}},addVideoEncodeCardFromServer:function(o){this.addVideoEncodeCard(o,l);},addVideoEncodeCardFromClient:function(o,p){this.addVideoEncodeCard(p,m);},addVideoEncodeCard:function(o,p){h.show(this._cardsContainer);var q=i.create('div',{className:'videoEncodeCard'});i.prependContent(this._cardsContainer,q);j.renderComponent(j.createElement(k,{progressBarConfig:this._progressBarConfig,videoID:o.videoID,thumbUrl:o.thumbUrl,origin:p}),q);}};e.exports=n;},null);